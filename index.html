<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gym Progress Tracker</title>
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
  <style>

    :root {
  --color-primary: #4f9f35;         /* green-ish */
  --color-primary-dark: #3a7d27;    /* darker green */
  --color-white: #fff;
  --border-radius: 14px;
  --box-shadow-light: 0 2px 8px rgba(0,0,0,0.1);
  --box-shadow-hover: 0 4px 12px rgba(0,0,0,0.15);
  
  /* Mobile-first responsive variables */
  --mobile-padding: 15px;
  --mobile-margin: 10px;
  --mobile-font-size: 16px;
  --mobile-button-height: 48px;
  --mobile-input-height: 44px;
}

  /* Base layout - Mobile First */
  body {
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(to bottom, #f0f2f5, #e6e9ed);
    margin: 0;
    padding: 0;
    color: #333;
    
    /* Mobile optimizations */
    -webkit-text-size-adjust: 100%;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    touch-action: manipulation;
    overflow-x: hidden;
  }

  .container {
    max-width: 800px;
    margin: 20px auto;
    padding: var(--mobile-padding);
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
    
    /* Mobile-first responsive */
    width: calc(100% - 30px);
    min-height: 100vh;
    box-sizing: border-box;
  }

  /* Mobile viewport adjustments */
  @media (max-width: 768px) {
    .container {
      margin: 10px auto;
      padding: 15px;
      width: calc(100% - 20px);
      border-radius: 8px;
    }
  }

  header {
    text-align: center;
    margin-bottom: 20px;
    position: relative;
  }

  /* Mobile-friendly header */
  @media (max-width: 768px) {
    header {
      margin-bottom: 15px;
    }
    
    header h1 {
      font-size: 1.8rem;
      margin: 10px 0;
    }
    
    header p {
      font-size: 0.9rem;
      margin: 5px 0;
    }
  }

  select, input {
    padding: 12px 16px;
    margin: 5px;
    font-size: var(--mobile-font-size);
    border: 1px solid #ccc;
    border-radius: 8px;
    transition: border-color 0.3s ease;
    min-height: var(--mobile-input-height);
    box-sizing: border-box;
    
    /* Mobile touch optimization */
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    touch-action: manipulation;
  }

  /* Mobile input optimizations */
  @media (max-width: 768px) {
    select, input {
      font-size: 16px; /* Prevents zoom on iOS */
      padding: 14px 16px;
      margin: 8px 0;
      width: 100%;
      max-width: 100%;
      border-radius: 10px;
    }
    
    /* Custom select arrow for mobile */
    select {
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 12px center;
      background-size: 16px;
      padding-right: 40px;
    }
  }

  select:focus, input:focus {
    border-color: #007bff;
    outline: none;
    box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
  }

  .save-exercise-btn:focus {
    outline: 2px solid #28a745;
    outline-offset: 2px;
  }

  button:focus {
    outline: 2px solid #007bff;
    outline-offset: 2px;
  }

  .weight-btn:focus {
    outline: 2px solid #6c757d !important;
    outline-offset: 1px !important;
  }

  .exercise {
    margin-top: 20px;
    padding: 0;
    border-radius: 12px;
    border: 2px solid transparent;
    transition: all 0.3s ease;
    background: #fff;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }

  .exercise-header {
    border-radius: 8px;
    user-select: none;
    transition: all 0.3s ease;
  }

  .exercise-header:hover {
    background: #e9ecef !important;
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }

  .exercise-content {
    padding: 0 20px 20px 20px;
    max-height: 1000px;
    opacity: 1;
    margin-top: 10px;
    transition: all 0.3s ease;
    overflow: hidden;
  }

  .collapse-icon {
    font-weight: bold;
    font-family: monospace;
  }

  /* Mobile exercise layout */
  @media (max-width: 768px) {
    .exercise {
      margin-top: 15px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .exercise-header {
      padding: 12px !important;
    }

    .exercise-header h3 {
      font-size: 1.1rem !important;
    }

    .collapse-icon {
      font-size: 1.1rem !important;
    }

    .exercise-content {
      padding: 0 15px 15px 15px;
    }
  }

  .exercise.saved {
    background-color: #d4edda;
    border-color: #28a745;
    box-shadow: 0 4px 12px rgba(40, 167, 69, 0.2);
  }

  body.dark-mode .exercise.saved {
    background-color: #1e3a28;
    border-color: #28a745;
  }

  .exercise h3 {
    margin-bottom: 15px;
    color: #007bff;
    border-left: 4px solid #007bff;
    padding-left: 12px;
    font-size: 1.2rem;
  }

  /* Mobile exercise header */
  @media (max-width: 768px) {
    .exercise h3 {
      font-size: 1.1rem;
      margin-bottom: 12px;
      padding-left: 10px;
    }
  }

  button {
    padding: 12px 20px;
    margin: 10px 5px;
    background: #007bff;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 500;
    font-size: var(--mobile-font-size);
    min-height: var(--mobile-button-height);
    transition: all 0.3s ease;
    
    /* Mobile touch optimization */
    touch-action: manipulation;
    user-select: none;
    -webkit-tap-highlight-color: transparent;
    position: relative;
    overflow: hidden;
  }

  /* Mobile button optimizations */
  @media (max-width: 768px) {
    button {
      padding: 16px 20px;
      margin: 8px 4px;
      font-size: 16px;
      border-radius: 12px;
      min-height: 52px;
      width: calc(50% - 8px);
      box-sizing: border-box;
    }
    
    /* Full-width buttons on mobile for main actions */
    #save-btn, 
    #load-last-btn,
    #day-select {
      width: 100%;
      margin: 8px 0;
    }
    
    /* Two-column layout for secondary buttons */
    #history-btn,
    #python-analytics-btn {
      width: calc(50% - 4px);
    }
    
    #auto-fill-btn,
    #reset-btn {
      width: calc(50% - 4px);
    }
  }

  button:hover {
    background: #0056b3;
    transform: translateY(-2px);
  }

  /* Touch feedback for mobile */
  @media (max-width: 768px) {
    button:active {
      transform: translateY(0);
      background: #004085;
    }
    
    button:hover {
      transform: none; /* Disable hover transform on mobile */
    }
  }

  .weight-btn {
    transition: all 0.2s ease !important;
  }

  .weight-btn:hover {
    background: #495057 !important;
    transform: scale(1.1) !important;
  }

  .set-container {
    background: #f8f9fa;
    padding: 12px;
    border-radius: 8px;
    margin: 8px 0 !important;
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 8px;
  }

  /* Mobile set container */
  @media (max-width: 768px) {
    .set-container {
      padding: 16px 12px;
      margin: 12px 0 !important;
      border-radius: 12px;
      flex-direction: column;
      align-items: stretch;
      gap: 12px;
    }
    
    .set-container label {
      font-weight: 600;
      color: #495057;
      margin-bottom: 8px;
      text-align: center;
    }
    
    /* Mobile weight adjustment controls */
    .weight-controls {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
    }
    
    .weight-controls input {
      flex: 1;
      max-width: 120px;
      text-align: center;
      font-size: 18px;
      font-weight: 600;
      margin: 0;
    }
    
    .weight-controls .weight-btn {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      font-weight: bold;
      margin: 0;
      padding: 0;
      min-height: unset;
    }
    
    .weight-controls .weight-btn:active {
      transform: scale(0.95);
    }
  }

  body.dark-mode .set-container {
    background: #3a3a3a;
    border: 1px solid #555;
    color: #e0e0e0;
  }

  /* Dark mode for "Last: Xkg" text */
  body.dark-mode .set-container span {
    color: #bb86fc !important;
  }

  /* Dark mode for set container labels */
  body.dark-mode .set-container label {
    color: #e0e0e0 !important;
  }

  /* Dark mode for progress suggestion text */
  body.dark-mode .exercise-suggestion {
    background: #2c4a2c !important;
    border-color: #28a745 !important;
    color: #b8e6b8 !important;
  }

  /* Dark mode for small text elements */
  body.dark-mode span[style*="color: #666"] {
    color: #bb86fc !important;
  }

  /* Dark mode for any remaining gray text */
  body.dark-mode * {
    color: inherit;
  }

  body.dark-mode .exercise * {
    color: inherit;
  }

  body.dark-mode .exercise {
    background: #2c2c2c;
    border-color: #444;
    color: #e0e0e0;
  }

  body.dark-mode .exercise-header {
    background: #2c2c2c !important;
    color: #e0e0e0;
  }

  body.dark-mode .exercise-header:hover {
    background: #3a3a3a !important;
  }

  body.dark-mode .exercise h3 {
    color: #bb86fc;
    border-left-color: #bb86fc;
  }

  .keyboard-help {
    background: #e7f3ff;
    padding: 12px;
    border-radius: 8px;
    margin-bottom: 15px;
    font-size: 0.9em;
    display: none !important;
  }

  /* Hide keyboard help on all screen sizes */
  @media (max-width: 768px) {
    .keyboard-help {
      display: none !important;
    }
  }

  /* Keep keyboard shortcuts hidden on all screens */
  @media (min-width: 769px) {
    .keyboard-help {
      display: none !important;
    }
  }

  body.dark-mode .keyboard-help {
    background: #1a2332;
    color: #e0e0e0;
  }

  .progress-indicator {
    display: inline-block;
    margin-left: 10px;
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 0.8em;
    font-weight: bold;
  }

  .progress-up {
    background: #d4edda;
    color: #155724;
  }

  .progress-down {
    background: #f8d7da;
    color: #721c24;
  }

  .progress-same {
    background: #fff3cd;
    color: #856404;
  }

  body.dark-mode .progress-up {
    background: #155724;
    color: #d4edda;
  }

  body.dark-mode .progress-down {
    background: #721c24;
    color: #f8d7da;
  }

  body.dark-mode .progress-same {
    background: #856404;
    color: #fff3cd;
  }

  .exercise-suggestion {
    background: #e8f5e8;
    border: 1px solid #28a745;
    border-radius: 4px;
    padding: 8px;
    margin: 8px 0;
    font-size: 0.9em;
  }

  body.dark-mode .exercise-suggestion {
    background: #1e3a28;
    border-color: #28a745;
    color: #d4edda;
  }

  #workout-timer {
    background: #f0f8ff;
    padding: 20px;
    border-radius: 12px;
    margin-bottom: 20px;
    text-align: center;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }

  /* Mobile workout timer */
  @media (max-width: 768px) {
    #workout-timer {
      padding: 16px;
      margin-bottom: 16px;
      border-radius: 12px;
    }
    
    #workout-timer h3 {
      font-size: 1.1rem;
      margin: 0 0 12px 0;
    }
    
    #workout-timer > div {
      flex-direction: column !important;
      gap: 12px !important;
    }
    
    #workout-timer > div > div {
      background: rgba(255,255,255,0.8);
      padding: 12px;
      border-radius: 8px;
      font-size: 1.1rem;
    }
    
    #workout-timer strong {
      display: block;
      margin-bottom: 4px;
      font-size: 0.9rem;
    }
    
    #total-time, #rest-time {
      font-size: 1.3rem;
      font-weight: bold;
      color: #007bff;
    }
  }

body.dark-mode #workout-timer {
  background: #2c2c2c;
  color: #e0e0e0;
  border: 1px solid #bb86fc;
  box-shadow: 0 0 8px rgba(187, 134, 252, 0.2);
}

body.dark-mode #workout-timer h3 {
  color: #bb86fc;
}

body.dark-mode #workout-timer strong {
  color: #bb86fc;
}

body.dark-mode #total-time,
body.dark-mode #rest-time {
  color: #03dac6;
  font-weight: bold;
}

body.dark-mode .keyboard-help {
  background: #1a2332;
  color: #e0e0e0;
  border: 1px solid #555;
}

body.dark-mode .modal-content {
  background: #2c2c2c;
  color: #ddd;
  border: 1px solid #555;
}

body.dark-mode #load-context-menu {
  background: #2c2c2c !important;
  border: 1px solid #555 !important;
  color: #e0e0e0;
}

body.dark-mode .context-item {
  color: #e0e0e0;
  border-bottom: 1px solid #555 !important;
}

body.dark-mode .context-item:hover {
  background: #3a3a3a !important;
}

body.dark-mode #close-modal {
  color: #e0e0e0;
  background: rgba(255,255,255,0.1) !important;
}

body.dark-mode #close-modal:hover {
  color: #bb86fc;
  background: rgba(255,255,255,0.2) !important;
}  .modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
    z-index: 1000;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }

  .modal-content {
    background: white;
    padding: 20px;
    margin: 5% auto;
    width: 90%;
    max-width: 600px;
    border-radius: 12px;
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
    position: relative;
    max-height: 90vh;
    overflow-y: auto;
  }

  /* Mobile modal optimizations */
  @media (max-width: 768px) {
    .modal-content {
      margin: 2% auto;
      width: 95%;
      padding: 20px 16px;
      border-radius: 16px 16px 0 0;
      max-height: 95vh;
      position: fixed;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      animation: slideUp 0.3s ease-out;
    }
    
    @keyframes slideUp {
      from {
        transform: translateX(-50%) translateY(100%);
      }
      to {
        transform: translateX(-50%) translateY(0);
      }
    }
    
    .modal-content h2 {
      font-size: 1.3rem;
      margin-bottom: 16px;
      padding-right: 40px;
    }
  }

  .hidden {
    display: none;
  }

  #close-modal {
    position: absolute;
    top: 16px;
    right: 16px;
    font-size: 1.8rem;
    cursor: pointer;
    color: #999;
    background: rgba(0,0,0,0.1);
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    z-index: 10;
  }

  #close-modal:hover {
    color: #000;
    background: rgba(0,0,0,0.2);
  }

  /* Mobile close button */
  @media (max-width: 768px) {
    #close-modal {
      top: 12px;
      right: 12px;
      width: 40px;
      height: 40px;
      font-size: 2rem;
      background: rgba(0,0,0,0.15);
    }
    
    #close-modal:active {
      transform: scale(0.95);
    }
  }
/* Quote Gallery - matching second code style */

.quote-gallery {
  display: flex;
  overflow-x: auto;
  scroll-behavior: smooth;
  gap: 1rem;
  padding: 0.5rem 1rem;
  margin: 1.5rem auto;
  max-width: 320px;
  box-sizing: border-box;
  scroll-snap-type: x mandatory;
  scroll-behavior: smooth;
  -webkit-overflow-scrolling: touch;
  background-color: transparent;
  border-radius: var(--border-radius);
  box-shadow: var(--box-shadow-light);
}

/* Mobile quote gallery optimizations */
@media (max-width: 768px) {
  .quote-gallery {
    max-width: 100%;
    margin: 1rem 0;
    padding: 0.5rem;
    gap: 0.8rem;
  }
}

.quote-gallery::-webkit-scrollbar {
  height: 6px;
}

.quote-gallery::-webkit-scrollbar-thumb {
  background-color: rgba(0, 0, 0, 0.1);
  border-radius: 3px;
}

/* Hide scrollbar on mobile */
@media (max-width: 768px) {
  .quote-gallery::-webkit-scrollbar {
    display: none;
  }
  
  .quote-gallery {
    scrollbar-width: none;
    -ms-overflow-style: none;
  }
}

.quote-gallery img {
  width: 300px;
  height: 180px;
  flex-shrink: 0;
  border-radius: var(--border-radius);
  object-fit: cover;
  scroll-snap-align: start;
  box-shadow: var(--box-shadow-light);
  cursor: pointer;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

/* Mobile image optimizations */
@media (max-width: 768px) {
  .quote-gallery img {
    width: 280px;
    height: 160px;
    border-radius: 12px;
  }
  
  .quote-gallery img:active {
    transform: scale(0.98);
  }
  
  .quote-gallery img:hover {
    transform: none; /* Disable hover on mobile */
  }
}

.quote-gallery img:hover,
.quote-gallery img:focus {
  transform: scale(1.05);
  box-shadow: var(--box-shadow-hover);
  outline: none;
}


.toast {
  position: fixed;
  bottom: 30px;
  left: 50%;
  transform: translateX(-50%);
  background-color: #28a745;
  color: white;
  padding: 16px 24px;
  border-radius: 8px;
  font-size: 1rem;
  z-index: 9999;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.4s ease, bottom 0.4s ease;
  max-width: 90%;
  text-align: center;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

/* Mobile toast optimizations */
@media (max-width: 768px) {
  .toast {
    bottom: 20px;
    padding: 16px 20px;
    border-radius: 12px;
    font-size: 16px;
    max-width: calc(100% - 40px);
    left: 20px;
    right: 20px;
    transform: none;
    text-align: left;
  }
}

.toast.show {
  opacity: 1;
  bottom: 50px;
  pointer-events: auto;
}

/* Mobile toast show state */
@media (max-width: 768px) {
  .toast.show {
    bottom: 30px;
  }
}

.toast.error {
  background-color: #dc3545;
}
/* Dark mode styles */
body.dark-mode {
  background: #121212;
  color: #e0e0e0;
}

body.dark-mode .container {
  background: #1e1e1e;
  box-shadow: 0 8px 20px rgba(255, 255, 255, 0.1);
}

body.dark-mode select,
body.dark-mode input {
  background: #2c2c2c;
  color: #e0e0e0;
  border-color: #555;
}

body.dark-mode select:focus,
body.dark-mode input:focus {
  border-color: #bb86fc;
  box-shadow: 0 0 0 2px rgba(187, 134, 252, 0.25);
}

body.dark-mode button {
  background: #bb86fc;
  color: #121212;
}

body.dark-mode button:hover {
  background: #9a67ea;
  color: #121212;
}

body.dark-mode .save-exercise-btn {
  background: #28a745 !important;
  color: #ffffff !important;
}

body.dark-mode .save-exercise-btn:hover {
  background: #218838 !important;
  color: #ffffff !important;
}

body.dark-mode #add-exercise-btn {
  background: #28a745 !important;
  color: #ffffff !important;
}

body.dark-mode #add-exercise-btn:hover {
  background: #218838 !important;
  color: #ffffff !important;
}

body.dark-mode .weight-btn {
  background: #495057 !important;
  color: #ffffff !important;
}

body.dark-mode .weight-btn:hover {
  background: #343a40 !important;
  color: #ffffff !important;
}

body.dark-mode #start-rest-btn {
  background: #ffc107 !important;
  color: #000000 !important;
}

body.dark-mode #start-rest-btn:hover {
  background: #e0a800 !important;
  color: #000000 !important;
}

body.dark-mode #stop-rest-btn {
  background: #6c757d !important;
  color: #ffffff !important;
}

body.dark-mode #stop-rest-btn:hover {
  background: #545b62 !important;
  color: #ffffff !important;
}

body.dark-mode #load-last-btn {
  background: #17a2b8 !important;
  color: #ffffff !important;
}

body.dark-mode #load-last-btn:hover {
  background: #138496 !important;
  color: #ffffff !important;
}

body.dark-mode #auto-fill-btn {
  background: #fd7e14 !important;
  color: #ffffff !important;
}

body.dark-mode #auto-fill-btn:hover {
  background: #e8681a !important;
  color: #ffffff !important;
}

body.dark-mode #reset-btn {
  background: #dc3545 !important;
  color: #ffffff !important;
}

body.dark-mode #reset-btn:hover {
  background: #c82333 !important;
  color: #ffffff !important;
}

body.dark-mode header p,
body.dark-mode .exercise h3 {
  color: #bb86fc;
}

body.dark-mode h1 {
  color: #e0e0e0;
}

body.dark-mode label {
  color: #e0e0e0;
}

body.dark-mode strong {
  color: #bb86fc;
}

body.dark-mode .modal-content {
  background: #2c2c2c;
  color: #ddd;
}

body.dark-mode .toast {
  background-color: #03dac6;
  color: #121212;
}

body.dark-mode .toast.error {
  background-color: #dc3545;
  color: #ffffff;
}

/* Mobile-specific styles and optimizations */
@media (max-width: 768px) {
  
  /* Mobile navigation */
  main {
    padding-bottom: 20px;
  }
  
  /* Mobile button groups */
  .button-group {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin: 12px 0;
  }
  
  .button-group.full-width > button {
    width: 100%;
    margin: 4px 0;
  }
  
  .button-group.two-column > button {
    width: calc(50% - 4px);
    margin: 4px 0;
  }
  
  /* Mobile progress tabs */
  #progress-tabs {
    flex-wrap: wrap !important;
    gap: 4px !important;
    margin-bottom: 16px !important;
  }
  
  #progress-tabs .tab-btn {
    flex: 1;
    min-width: calc(50% - 2px);
    padding: 12px 8px !important;
    font-size: 14px !important;
    border-radius: 8px !important;
  }
  
  /* Mobile stats cards */
  #stats-cards {
    grid-template-columns: repeat(2, 1fr) !important;
    gap: 12px !important;
  }
  
  .stat-card {
    padding: 16px 12px !important;
    border-radius: 10px !important;
  }
  
  .stat-card h3 {
    font-size: 1.8rem !important;
    margin: 0 0 8px 0 !important;
  }
  
  .stat-card p {
    font-size: 0.85rem !important;
  }
  
  /* Mobile session cards */
  .session-card {
    margin-bottom: 8px !important;
    border-radius: 10px !important;
  }
  
  .session-header {
    padding: 12px 16px !important;
    flex-direction: column !important;
    align-items: flex-start !important;
    gap: 8px !important;
  }
  
  .session-header > div {
    display: flex !important;
    flex-direction: column !important;
    gap: 4px !important;
  }
  
  .session-details {
    padding: 0 16px !important;
  }
  
  .session-details > div {
    padding: 12px 0 !important;
  }
  
  .session-details > div > div {
    margin-bottom: 8px !important;
    padding: 8px !important;
    font-size: 14px !important;
  }
  
  /* Mobile personal records */
  #personal-records {
    grid-template-columns: 1fr !important;
    gap: 12px !important;
  }
  
  /* Mobile insights */
  #ai-insights {
    padding: 16px !important;
    border-radius: 10px !important;
    margin-bottom: 16px !important;
  }
  
  #ai-insights h3 {
    font-size: 1.2rem !important;
    margin: 0 0 12px 0 !important;
  }
  
  #insights-content > div {
    margin-bottom: 12px !important;
    padding: 12px !important;
    border-radius: 6px !important;
  }
  
  #workout-patterns > div {
    grid-template-columns: 1fr !important;
    gap: 12px !important;
  }
  
  #workout-patterns > div > div {
    padding: 12px !important;
    border-radius: 6px !important;
  }
  
  /* Mobile chart container */
  #progress-charts {
    margin-bottom: 16px !important;
  }
  
  #progress-chart {
    height: 250px !important;
    border-radius: 6px !important;
  }
  
  #exercise-filters {
    margin-bottom: 16px !important;
    display: flex !important;
    flex-direction: column !important;
    gap: 12px !important;
  }
  
  #exercise-filters > label {
    font-weight: 600 !important;
    margin-bottom: 4px !important;
  }
  
  #exercise-filters select {
    margin: 0 !important;
  }
  
  /* Mobile dark mode switch */
  .switch {
    transform: scale(1.2);
  }
  
  /* Mobile motivational quote */
  header p {
    line-height: 1.4;
    padding: 0 10px;
  }
  
  /* Mobile context menu */
  #load-context-menu {
    width: 90% !important;
    max-width: 280px !important;
    border-radius: 12px !important;
    box-shadow: 0 8px 24px rgba(0,0,0,0.2) !important;
  }
  
  .context-item {
    padding: 16px 20px !important;
    font-size: 16px !important;
    border-bottom: 1px solid #eee !important;
  }
  
  .context-item:last-child {
    border-bottom: none !important;
    border-radius: 0 0 12px 12px !important;
  }
  
  .context-item:first-child {
    border-radius: 12px 12px 0 0 !important;
  }
  
  /* Mobile exercise suggestion */
  .exercise-suggestion {
    padding: 12px !important;
    margin: 10px 0 !important;
    border-radius: 6px !important;
    font-size: 14px !important;
  }
  
  /* Mobile progress indicators */
  .progress-indicator {
    padding: 4px 8px !important;
    border-radius: 6px !important;
    font-size: 0.75rem !important;
  }
  
  /* Prevent text selection on buttons for mobile */
  button, .weight-btn {
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
  }
  
  /* Mobile viewport fix */
  html {
    -webkit-text-size-adjust: 100%;
  }
  
  /* Mobile input improvements */
  input[type="number"] {
    appearance: textfield;
    -moz-appearance: textfield;
  }
  
  input[type="number"]::-webkit-outer-spin-button,
  input[type="number"]::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }
  
  /* Mobile loading states */
  .btn-loading {
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    gap: 8px !important;
  }
}

/* Touch device optimizations */
@media (hover: none) and (pointer: coarse) {
  button:hover,
  .weight-btn:hover,
  .quote-gallery img:hover {
    transform: none;
  }
  
  button:active,
  .weight-btn:active {
    transform: scale(0.98);
    transition: transform 0.1s ease;
  }
  
  .session-card:active {
    transform: scale(0.995);
    transition: transform 0.1s ease;
  }
}

/* Landscape mobile optimizations */
@media (max-width: 768px) and (orientation: landscape) {
  .container {
    padding: 12px;
    margin: 5px auto;
  }
  
  header {
    margin-bottom: 12px;
  }
  
  header h1 {
    font-size: 1.6rem;
    margin: 8px 0;
  }
  
  #workout-timer {
    padding: 12px;
    margin-bottom: 12px;
  }
  
  #workout-timer > div {
    flex-direction: row !important;
    gap: 16px !important;
  }
  
  .exercise {
    margin-top: 12px;
    padding: 12px;
  }
  
  .set-container {
    flex-direction: row !important;
    align-items: center !important;
    gap: 8px !important;
  }
  
  .weight-controls {
    flex-direction: row !important;
  }
}

/* Very small screens (below 400px) */
@media (max-width: 400px) {
  .container {
    width: calc(100% - 10px);
    margin: 5px auto;
    padding: 12px;
  }
  
  header h1 {
    font-size: 1.6rem;
  }
  
  button {
    font-size: 14px;
    padding: 14px 16px;
  }
  
  .exercise h3 {
    font-size: 1rem;
  }
  
  .weight-controls input {
    max-width: 100px;
    font-size: 16px;
  }
  
  .weight-controls .weight-btn {
    width: 40px;
    height: 40px;
    font-size: 16px;
  }
  
  #stats-cards {
    grid-template-columns: 1fr !important;
  }
}

/* Session card styles */
.session-card {
  background: white;
  border: 2px solid #eee;
  border-radius: 12px;
  margin-bottom: 10px;
  overflow: hidden;
  transition: all 0.3s ease;
  cursor: pointer;
}

.session-header {
  padding: 15px 20px;
  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.session-details {
  padding: 0 20px;
  max-height: 0;
  overflow: hidden;
  transition: all 0.3s ease;
}

.exercise-item {
  margin-bottom: 10px;
  padding: 10px;
  background: #f8f9fa;
  border-radius: 8px;
}

/* Dark mode session cards */
body.dark-mode .session-card {
  background: #2c2c2c;
  border: 2px solid #555;
  color: #e0e0e0;
}

body.dark-mode .session-header {
  background: linear-gradient(135deg, #3a3a3a 0%, #444 100%);
}

body.dark-mode .exercise-item {
  background: #3a3a3a;
  color: #e0e0e0;
}

body.dark-mode .session-card strong {
  color: #bb86fc !important;
}

body.dark-mode .session-card .expand-icon {
  color: #bb86fc !important;
}

/* Dark mode for progress tabs */
body.dark-mode .tab-btn {
  background: #3a3a3a !important;
  color: #e0e0e0 !important;
  border: 1px solid #555 !important;
}

body.dark-mode .tab-btn.active {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
  color: white !important;
}

/* Dark mode for stats cards content */
body.dark-mode #recent-sessions h3 {
  color: #bb86fc !important;
}

/* Dark mode for chart canvas */
body.dark-mode #progress-chart {
  background: #2c2c2c;
  border: 1px solid #555 !important;
}

/* Dark mode workout patterns section */
body.dark-mode #workout-patterns h3 {
  color: #bb86fc !important;
}

body.dark-mode #workout-patterns > div > div {
  background: #3a3a3a !important;
  color: #e0e0e0 !important;
  border-left: 4px solid #bb86fc !important;
}

/* Dark mode for filters */
body.dark-mode #exercise-filters label {
  color: #e0e0e0 !important;
}

/* Global dark mode catch-all for any remaining white backgrounds */
body.dark-mode .modal-content *:not(.stat-card):not([style*="gradient"]) {
  background-color: inherit;
}

/* Dark mode for mobile workout timer */
@media (max-width: 768px) {
  body.dark-mode #workout-timer > div > div {
    background: rgba(187, 134, 252, 0.2) !important;
    color: #e0e0e0;
  }
}

/* Touch device specific styles */
.touch-device button:hover {
  transform: none !important;
}

.touch-device button:active {
  transform: scale(0.98) !important;
  transition: transform 0.1s ease !important;
}

/* Keyboard open state adjustments */
.keyboard-open {
  height: 100vh;
  overflow: hidden;
}

.keyboard-open .container {
  height: calc(100vh - 20px);
  overflow-y: auto;
}

.keyboard-open .modal-content {
  max-height: 60vh;
}

body.dark-mode #day-select {
  background: #2c2c2c;
  color: #e0e0e0;
  border-color: #555;
}

body.dark-mode #day-select:focus {
  border-color: #bb86fc;
  box-shadow: 0 0 0 2px rgba(187, 134, 252, 0.25);
}

/* Toggle Switch container */
.switch {
  position: fixed;
  top: 1rem;
  right: 1rem;
  display: inline-block;
  width: 52px;
  height: 28px;
  cursor: pointer;
  user-select: none;
  z-index: 10000;
  position: relative;
}

/* Hide default checkbox */
.switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

/* The slider background */
.slider {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #ccc;
  border-radius: 34px;
  transition: background-color 0.4s ease;
  box-shadow: 0 0 6px rgba(0,0,0,0.1);
}

/* The round knob */
.slider::before {
  position: absolute;
  content: "";
  height: 22px;
  width: 22px;
  left: 3px;
  bottom: 3px;
  background-color: white;
  border-radius: 50%;
  box-shadow: 0 1px 3px rgba(0,0,0,0.3);
  transition: transform 0.4s ease, background-color 0.4s ease;
}

/* When checked (dark mode on) */
.switch input:checked + .slider {
  background-color: var(--color-primary-dark);
  box-shadow: 0 0 10px var(--color-primary-dark);
}

.switch input:checked + .slider::before {
  transform: translateX(24px);
  background-color: var(--color-primary);
}

/* Optional: glow effect on hover */
.switch:hover .slider {
  box-shadow: 0 0 12px rgba(0, 123, 255, 0.6);
}

.switch:hover input:checked + .slider {
  box-shadow: 0 0 16px var(--color-primary-dark);
}

body.dark-mode .quote-gallery::-webkit-scrollbar {
  height: 8px;
}

body.dark-mode .quote-gallery::-webkit-scrollbar-track {
  background: #222; /* dark background */
  border-radius: 10px;
}

body.dark-mode .quote-gallery::-webkit-scrollbar-thumb {
  background: #555; /* thumb color */
  border-radius: 10px;
}

body.dark-mode .quote-gallery::-webkit-scrollbar-thumb:hover {
  background: #888; /* on hover */
}

body.dark-mode #load-context-menu {
  background: #2c2c2c !important;
  border-color: #555 !important;
  color: #e0e0e0 !important;
}

body.dark-mode .context-item {
  color: #e0e0e0 !important;
  border-bottom-color: #444 !important;
}

body.dark-mode .context-item:hover {
  background: #3a3a3a !important;
}

body.dark-mode #sessions-modal .modal-content {
  background: #2c2c2c;
  color: #e0e0e0;
  border: 1px solid #555;
}

body.dark-mode #sessions-list > div {
  background: #3a3a3a !important;
  border-color: #555 !important;
  color: #e0e0e0 !important;
}

body.dark-mode #add-exercise-modal .modal-content {
  background: #2c2c2c;
  color: #e0e0e0;
  border: 1px solid #555;
}

body.dark-mode #exercise-name-input,
body.dark-mode #exercise-category-select {
  background: #3a3a3a !important;
  color: #e0e0e0 !important;
  border-color: #555 !important;
}

body.dark-mode #exercise-name-input:focus,
body.dark-mode #exercise-category-select:focus {
  border-color: #667eea !important;
  outline: none;
}

body.dark-mode #save-exercise-btn {
  background: #28a745 !important;
}

body.dark-mode #cancel-exercise-btn {
  background: #6c757d !important;
}

body.dark-mode #add-exercise-modal .modal-content > div:last-child {
  background: #3a3a3a !important;
  border: 1px solid #555;
}

body.dark-mode #sessions-list > div:hover {
  background: #4a4a4a !important;
}

/* Enhanced Progress Modal Styles */
.tab-content.hidden {
  display: none !important;
}

.session-card:hover {
  border-color: #667eea !important;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
}

.stat-card {
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.stat-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

#history-btn:hover .shine-effect {
  left: 100% !important;
}

#python-analytics-btn:hover .python-shine-effect {
  left: 100% !important;
}

/* Dark mode for enhanced progress modal */
body.dark-mode .tab-btn {
  background: #3a3a3a !important;
  color: #e0e0e0 !important;
}

body.dark-mode .tab-btn.active {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
  color: white !important;
}

body.dark-mode .session-card {
  background: #2c2c2c !important;
  border-color: #555 !important;
}

body.dark-mode .session-header {
  background: linear-gradient(135deg, #3a3a3a 0%, #2c2c2c 100%) !important;
}

body.dark-mode .session-card:hover {
  border-color: #667eea !important;
}
main {
   flex: 1;
  max-width: 960px;
  margin: 2rem auto;
  padding: 0 1.5rem;
  width: 100%;
}

/* Sidebar Styles */
.app-layout {
  display: flex;
  min-height: 100vh;
  gap: 20px;
  max-width: 1400px;
  margin: 0 auto;
  padding: 20px;
}

.sidebar {
  position: fixed;
  top: 0;
  right: 0;
  width: 320px;
  height: 100vh;
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border-left: 1px solid rgba(102, 126, 234, 0.2);
  box-shadow: -10px 0 40px rgba(0,0,0,0.15);
  padding: 25px;
  overflow-y: auto;
  z-index: 1000;
  transform: translateX(100%);
  transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

.sidebar.open {
  transform: translateX(0);
  box-shadow: -15px 0 50px rgba(0,0,0,0.2);
}

.sidebar-toggle {
  position: fixed;
  top: 25px;
  right: 25px;
  width: 60px;
  height: 60px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
  border-radius: 50%;
  font-size: 1.8rem;
  cursor: pointer;
  z-index: 1001;
  box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
  transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  display: flex;
  align-items: center;
  justify-content: center;
  backdrop-filter: blur(10px);
  border: 2px solid rgba(255, 255, 255, 0.2);
}

.sidebar-toggle:hover {
  transform: scale(1.15) rotate(5deg);
  box-shadow: 0 12px 35px rgba(102, 126, 234, 0.6);
  background: linear-gradient(135deg, #5a67d8 0%, #667eea 100%);
}

.sidebar-toggle:active {
  transform: scale(1.05);
}

.sidebar-section {
  margin-bottom: 30px;
  background: rgba(255, 255, 255, 0.8);
  backdrop-filter: blur(15px);
  border-radius: 16px;
  padding: 24px;
  box-shadow: 0 8px 32px rgba(0,0,0,0.08);
  border: 1px solid rgba(255, 255, 255, 0.3);
  position: relative;
  overflow: hidden;
  transition: all 0.3s ease;
}

.sidebar-section::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: linear-gradient(90deg, #667eea, #764ba2, #f093fb, #f5576c);
  background-size: 200% 100%;
  animation: gradient-shift 3s ease infinite;
}

@keyframes gradient-shift {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

.sidebar-section:hover {
  transform: translateY(-2px);
  box-shadow: 0 12px 40px rgba(0,0,0,0.12);
}

.sidebar-section h3 {
  margin: 0 0 20px 0;
  color: #4a5568;
  font-size: 1.2rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  position: relative;
  padding-left: 15px;
}

.sidebar-section h3::before {
  content: '';
  position: absolute;
  left: 0;
  top: 50%;
  transform: translateY(-50%);
  width: 4px;
  height: 20px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius: 2px;
}

.sidebar-btn {
  width: 100%;
  padding: 16px 20px;
  margin-bottom: 12px;
  border: none;
  border-radius: 12px;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  display: flex;
  align-items: center;
  gap: 12px;
  position: relative;
  overflow: hidden;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  text-shadow: 0 1px 2px rgba(0,0,0,0.1);
}

.sidebar-btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
  transition: left 0.6s ease;
}

.sidebar-btn:hover::before {
  left: 100%;
}

.sidebar-btn:last-child {
  margin-bottom: 0;
}

.sidebar-btn:hover {
  transform: translateY(-3px) scale(1.02);
  box-shadow: 0 8px 25px rgba(0,0,0,0.2);
}

.sidebar-btn:active {
  transform: translateY(-1px) scale(0.98);
}

.sidebar-btn.primary {
  background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
  color: white;
  box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
}

.sidebar-btn.primary:hover {
  background: linear-gradient(135deg, #218838 0%, #1db584 100%);
  box-shadow: 0 8px 25px rgba(40, 167, 69, 0.4);
}

.sidebar-btn.secondary {
  background: linear-gradient(135deg, #17a2b8 0%, #6f42c1 100%);
  color: white;
  box-shadow: 0 4px 15px rgba(23, 162, 184, 0.3);
}

.sidebar-btn.secondary:hover {
  background: linear-gradient(135deg, #138496 0%, #5a2d91 100%);
  box-shadow: 0 8px 25px rgba(23, 162, 184, 0.4);
}

.sidebar-btn.warning {
  background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
  color: #333;
  box-shadow: 0 4px 15px rgba(255, 193, 7, 0.3);
}

.sidebar-btn.warning:hover {
  background: linear-gradient(135deg, #e0a800 0%, #e8690b 100%);
  box-shadow: 0 8px 25px rgba(255, 193, 7, 0.4);
}

.sidebar-btn.danger {
  background: linear-gradient(135deg, #dc3545 0%, #e83e8c 100%);
  color: white;
  box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
}

.sidebar-btn.danger:hover {
  background: linear-gradient(135deg, #c82333 0%, #d91a72 100%);
  box-shadow: 0 8px 25px rgba(220, 53, 69, 0.4);
}

.sidebar-btn.info {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
}

.sidebar-btn.info:hover {
  background: linear-gradient(135deg, #5a67d8 0%, #68408d 100%);
  box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
}

.sidebar-btn.special {
  background: linear-gradient(135deg, #FF6B6B 0%, #4ECDC4 100%);
  color: white;
  box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
  position: relative;
}

.sidebar-btn.special:hover {
  background: linear-gradient(135deg, #ff5252 0%, #26a69a 100%);
  box-shadow: 0 8px 25px rgba(255, 107, 107, 0.4);
}

.sidebar-btn.special::after {
  content: '✨';
  position: absolute;
  top: 8px;
  right: 12px;
  font-size: 1.2rem;
  animation: sparkle 2s ease-in-out infinite;
}

@keyframes sparkle {
  0%, 100% { opacity: 0.7; transform: scale(1); }
  50% { opacity: 1; transform: scale(1.2); }
}

/* Timer section in sidebar */
.timer-section {
  background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
  border: 2px solid rgba(255, 193, 7, 0.4);
  position: relative;
}

.timer-section::before {
  background: linear-gradient(90deg, #ffc107, #fd7e14, #ff6b6b);
}

.timer-display {
  text-align: center;
  margin: 20px 0;
}

.timer-display > div {
  background: rgba(255, 255, 255, 0.9);
  backdrop-filter: blur(10px);
  padding: 15px;
  border-radius: 12px;
  margin-bottom: 12px;
  font-weight: 700;
  font-size: 1.1rem;
  border: 1px solid rgba(255, 255, 255, 0.3);
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.timer-controls {
  display: flex;
  gap: 12px;
}

.timer-controls button {
  flex: 1;
  padding: 12px;
  border: none;
  border-radius: 10px;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.3);
}

/* Dark mode sidebar */
body.dark-mode .sidebar {
  background: rgba(30, 30, 30, 0.95);
  backdrop-filter: blur(25px);
  border-left: 1px solid rgba(187, 134, 252, 0.3);
  box-shadow: -15px 0 50px rgba(0,0,0,0.3);
}

body.dark-mode .sidebar-section {
  background: rgba(45, 45, 45, 0.8);
  color: #e0e0e0;
  border: 1px solid rgba(255, 255, 255, 0.1);
}

body.dark-mode .sidebar-section::before {
  background: linear-gradient(90deg, #bb86fc, #667eea, #4ECDC4, #FF6B6B);
}

body.dark-mode .sidebar-section h3 {
  color: #bb86fc;
}

body.dark-mode .sidebar-section h3::before {
  background: linear-gradient(135deg, #bb86fc 0%, #667eea 100%);
}

body.dark-mode .sidebar-toggle {
  background: linear-gradient(135deg, #bb86fc 0%, #667eea 100%);
  border: 2px solid rgba(187, 134, 252, 0.3);
  box-shadow: 0 8px 25px rgba(187, 134, 252, 0.4);
}

body.dark-mode .sidebar-toggle:hover {
  background: linear-gradient(135deg, #a370f7 0%, #5a67d8 100%);
  box-shadow: 0 12px 35px rgba(187, 134, 252, 0.6);
}

body.dark-mode .timer-section {
  background: linear-gradient(135deg, rgba(74, 74, 74, 0.8) 0%, rgba(90, 90, 90, 0.8) 100%);
  border: 2px solid rgba(255, 193, 7, 0.4);
}

body.dark-mode .timer-display > div {
  background: rgba(30, 30, 30, 0.9);
  color: #e0e0e0;
  border: 1px solid rgba(255, 255, 255, 0.1);
}

/* Mobile sidebar adjustments */
@media (max-width: 768px) {
  .sidebar {
    width: 100vw;
    padding: 20px;
    backdrop-filter: blur(30px);
  }
  
  .sidebar-toggle {
    width: 55px;
    height: 55px;
    font-size: 1.6rem;
    top: 20px;
    right: 20px;
  }
  
  .app-layout {
    padding: 10px;
  }
  
  main {
    margin-right: 0;
    max-width: 100%;
  }
  
  .sidebar-section {
    margin-bottom: 20px;
    padding: 20px;
  }
  
  .sidebar-btn {
    padding: 18px 20px;
    font-size: 1.1rem;
  }
}

@media (max-width: 480px) {
  .sidebar {
    padding: 15px;
  }
  
  .sidebar-section {
    padding: 18px;
  }
  
  .sidebar-btn {
    padding: 16px 18px;
    font-size: 1rem;
  }
}

/* Content shift when sidebar is open */
.sidebar-open main {
  margin-right: 340px;
  transition: margin-right 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

@media (max-width: 768px) {
  .sidebar-open main {
    margin-right: 0;
    filter: blur(2px);
    transition: filter 0.3s ease;
  }
  
  .sidebar-open::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 999;
  }
}

/* Scrollbar styling for sidebar */
.sidebar::-webkit-scrollbar {
  width: 6px;
}

.sidebar::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.1);
  border-radius: 3px;
}

.sidebar::-webkit-scrollbar-thumb {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius: 3px;
}

.sidebar::-webkit-scrollbar-thumb:hover {
  background: linear-gradient(135deg, #5a67d8 0%, #68408d 100%);
}

body.dark-mode .sidebar::-webkit-scrollbar-track {
  background: rgba(0, 0, 0, 0.2);
}

body.dark-mode .sidebar::-webkit-scrollbar-thumb {
  background: linear-gradient(135deg, #bb86fc 0%, #667eea 100%);
}

/* Floating animation for special button */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-3px); }
}

.sidebar-btn.special {
  animation: float 3s ease-in-out infinite;
}

.sidebar-btn.special:hover {
  animation: none;
}


</style>

</head>
<body>
  <header>
    <h1>🏋️‍♂️ Gym Progress Tracker</h1>
    <p id="motivational-quote">Push yourself, because no one else is going to do it for you.</p>
    <label class="switch" title="Toggle Dark Mode">
     <input type="checkbox" id="dark-mode-toggle" />
     <span class="slider"></span>
   </label>

  </header>
  <div class="quote-gallery">
    <img src="quote1.jpg" alt="Motivation 1" />
    <img src="quote2.jpg" alt="Motivation 2" />
    <img src="quote3.jpg" alt="Motivation 3" />
    <img src="quote4.jpg" alt="Motivation 4" />
  </div>



  <main>
    <div class="keyboard-help">
      <strong>⌨️ Keyboard Shortcuts:</strong> 
      <span style="margin-right: 15px;">Tab/Arrow Keys: Navigate</span>
      <span style="margin-right: 15px;">Enter: Save Exercise</span>
      <span style="margin-right: 15px;">Ctrl+/Ctrl-: Adjust Weight</span>
      <span style="margin-right: 15px;">F1: First Input</span>
      <span style="margin-right: 15px;">F2: Load Last</span>
      <span style="margin-right: 15px;">F3: View Progress</span>
      <span style="margin-right: 15px;">F4: Start Rest</span>
      <span>F5: Stop Rest</span>
    </div>
    
    <label for="day-select">Select Workout Day:</label>
    <select id="day-select">
      <option value="Chest">Chest</option>
      <option value="Back">Back</option>
      <option value="Legs">Legs</option>
      <option value="Shoulders">Shoulders</option>
    </select>

    <div id="exercise-container"></div>

  </main>

  <!-- Professional Sidebar -->
  <button class="sidebar-toggle" id="sidebar-toggle" title="Open Control Panel">
    ⚙️
  </button>

  <div class="sidebar" id="sidebar">
    <!-- Workout Timer Section -->
    <div class="sidebar-section timer-section">
      <h3>⏱️ Workout Timer</h3>
      <div class="timer-display">
        <div>
          <strong>Total Time:</strong> <span id="total-time">00:00:00</span>
        </div>
        <div>
          <strong>Rest Timer:</strong> <span id="rest-time">00:00</span>
        </div>
      </div>
      <div class="timer-controls">
        <button id="start-rest-btn" style="background: #ffc107; color: #000; font-weight: 600;">
          ⏰ Start Rest
        </button>
        <button id="stop-rest-btn" style="background: #6c757d; color: white; font-weight: 600;">
          ⏹️ Stop
        </button>
      </div>
    </div>

    <!-- Workout Controls Section -->
    <div class="sidebar-section">
      <h3>🏋️ Workout Controls</h3>
      <button id="add-exercise-btn" class="sidebar-btn primary">
        ➕ Add New Exercise
      </button>
      <button id="save-btn" class="sidebar-btn primary">
        💾 Save Workout
      </button>
    </div>

    <!-- Data Management Section -->
    <div class="sidebar-section">
      <h3>� Data Management</h3>
      <button id="load-last-btn" class="sidebar-btn secondary" style="position: relative;">
        <span class="btn-text">📋 Load Last Session</span>
        <span class="btn-loading" style="display: none;">⏳ Loading...</span>
      </button>
      <button id="auto-fill-btn" class="sidebar-btn warning">
        🎯 Auto-Fill Suggested
      </button>
      <button id="reset-btn" class="sidebar-btn danger">
        🗑️ Reset All Data
      </button>
    </div>

    <!-- Analytics Section -->
    <div class="sidebar-section">
      <h3>📈 Analytics & Reports</h3>
      <button id="history-btn" class="sidebar-btn info" style="position: relative; overflow: hidden;">
        <span style="position: relative; z-index: 2;">📊 Progress Analytics</span>
        <span style="position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent); transition: left 0.5s; z-index: 1;" class="shine-effect"></span>
      </button>
      <button id="python-analytics-btn" class="sidebar-btn special" style="position: relative; overflow: hidden;">
        <span style="position: relative; z-index: 2;">🐍 Python Analytics</span>
        <span style="position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent); transition: left 0.5s; z-index: 1;" class="python-shine-effect"></span>
      </button>
    </div>

    <!-- Quick Stats Section -->
    <div class="sidebar-section">
      <h3>📋 Quick Info</h3>
      <div style="text-align: center; padding: 10px;">
        <div style="font-size: 0.9rem; color: #666; margin-bottom: 10px;">
          <strong>Current Day:</strong> <span id="current-day-display">Chest</span>
        </div>
        <div style="font-size: 0.9rem; color: #666;">
          <strong>Exercises Added:</strong> <span id="exercises-count-display">0</span>
        </div>
      </div>
    </div>
  </div>

  <div id="load-context-menu" class="hidden" style="
    position: fixed;
    background: white;
    border: 1px solid #ddd;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    z-index: 10000;
    min-width: 200px;
    padding: 8px 0;
  ">
    <div class="context-item" data-action="load-last" style="padding: 10px 15px; cursor: pointer; border-bottom: 1px solid #eee;">
      📋 Load Most Recent
    </div>
    <div class="context-item" data-action="load-complete" style="padding: 10px 15px; cursor: pointer; border-bottom: 1px solid #eee;">
      📊 Load Last Complete Workout
    </div>
    <div class="context-item" data-action="load-best" style="padding: 10px 15px; cursor: pointer; border-bottom: 1px solid #eee;">
      🏆 Load Best Performance
    </div>
    <div class="context-item" data-action="browse-sessions" style="padding: 10px 15px; cursor: pointer;">
      📖 Browse All Sessions
    </div>
  </div>
  
  <div id="progress-modal" class="modal hidden">
    <div class="modal-content" style="max-width: 1200px; max-height: 90vh; overflow-y: auto;">
      <span id="close-modal" style="float: right; font-size: 1.5rem; cursor: pointer; color: #999;">&times;</span>
      <h2 style="margin-bottom: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">  Advanced Progress Analytics</h2>
      
      <!-- Navigation Tabs -->
      <div id="progress-tabs" style="display: flex; margin-bottom: 20px; border-bottom: 2px solid #eee;">
        <button class="tab-btn active" data-tab="overview" style="flex: 1; padding: 12px; border: none; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; cursor: pointer; margin-right: 2px;">📊 Overview</button>
        <button class="tab-btn" data-tab="trends" style="flex: 1; padding: 12px; border: none; background: #f8f9fa; color: #666; cursor: pointer; margin-right: 2px;">📈 Trends</button>
        <button class="tab-btn" data-tab="records" style="flex: 1; padding: 12px; border: none; background: #f8f9fa; color: #666; cursor: pointer; margin-right: 2px;">🏆 Records</button>
        <button class="tab-btn" data-tab="insights" style="flex: 1; padding: 12px; border: none; background: #f8f9fa; color: #666; cursor: pointer;">🧠 Insights</button>
      </div>

      <!-- Tab Content -->
      <div id="tab-overview" class="tab-content">
        <div id="stats-cards" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 20px;"></div>
        <div id="recent-sessions" style="margin-top: 20px;"></div>
      </div>

      <div id="tab-trends" class="tab-content hidden">
        <div id="progress-charts" style="margin-bottom: 20px;">
          <canvas id="progress-chart" width="800" height="400" style="max-width: 100%; border: 1px solid #ddd; border-radius: 8px;"></canvas>
        </div>
        <div id="exercise-filters" style="margin-bottom: 20px;">
          <label>Filter by Exercise: </label>
          <select id="exercise-filter" style="padding: 8px; margin: 0 10px; border-radius: 4px; border: 1px solid #ddd;">
            <option value="all">All Exercises</option>
          </select>
          <label>Time Range: </label>
          <select id="time-filter" style="padding: 8px; border-radius: 4px; border: 1px solid #ddd;">
            <option value="30">Last 30 Days</option>
            <option value="60">Last 60 Days</option>
            <option value="90">Last 90 Days</option>
            <option value="all">All Time</option>
          </select>
        </div>
      </div>

      <div id="tab-records" class="tab-content hidden">
        <div id="personal-records" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px;"></div>
      </div>

      <div id="tab-insights" class="tab-content hidden">
        <div id="ai-insights" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); padding: 20px; border-radius: 12px; color: white; margin-bottom: 20px;">
          <h3 style="margin: 0 0 15px 0;">🧠 AI Performance Insights</h3>
          <div id="insights-content"></div>
        </div>
        <div id="workout-patterns" style="margin-top: 20px;"></div>
      </div>

      <div id="history-logs" style="display: none;"></div>
    </div>
  </div>
  
  <div id="toast" class="toast hidden"></div>

  <div id="sessions-modal" class="modal hidden">
    <div class="modal-content">
      <span id="close-sessions-modal" style="float: right; font-size: 1.5rem; cursor: pointer; color: #999;">&times;</span>
      <h2>📖 Browse Sessions</h2>
      <div id="sessions-list" style="max-height: 400px; overflow-y: auto;"></div>
    </div>
  </div>

  <div id="add-exercise-modal" class="modal hidden">
    <div class="modal-content" style="max-width: 500px;">
      <span id="close-add-exercise-modal" style="float: right; font-size: 1.5rem; cursor: pointer; color: #999;">&times;</span>
      <h2>➕ Add New Exercise</h2>
      
      <div style="margin: 20px 0;">
        <label for="exercise-name-input" style="display: block; margin-bottom: 10px; font-weight: bold;">Exercise Name:</label>
        <input type="text" id="exercise-name-input" placeholder="e.g., Deadlift, Pull-ups, Bicep Curls..." 
               style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; margin-bottom: 15px;"/>
        
        <label for="exercise-category-select" style="display: block; margin-bottom: 10px; font-weight: bold;">Category:</label>
        <select id="exercise-category-select" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; margin-bottom: 20px;">
          <option value="Chest">Chest</option>
          <option value="Back">Back</option>
          <option value="Legs">Legs</option>
          <option value="Shoulders">Shoulders</option>
          <option value="Arms">Arms</option>
          <option value="Core">Core</option>
          <option value="Cardio">Cardio</option>
          <option value="Other">Other</option>
        </select>
        
        <div style="display: flex; gap: 10px; margin-top: 20px;">
          <button id="save-exercise-btn" style="flex: 1; background: #28a745; color: white; border: none; padding: 12px; border-radius: 8px; font-size: 16px; cursor: pointer;">
            ✅ Add Exercise
          </button>
          <button id="cancel-exercise-btn" style="flex: 1; background: #6c757d; color: white; border: none; padding: 12px; border-radius: 8px; font-size: 16px; cursor: pointer;">
            ❌ Cancel
          </button>
        </div>
      </div>
      
      <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 20px;">
        <h4 style="margin: 0 0 10px 0; color: #495057;">💡 Tips:</h4>
        <ul style="margin: 0; padding-left: 20px; color: #6c757d;">
          <li>Choose descriptive names like "Incline Dumbbell Press"</li>
          <li>Select the most appropriate muscle group category</li>
          <li>Your custom exercises will be saved permanently</li>
          <li>You can track progress just like default exercises</li>
        </ul>
      </div>
    </div>
  </div>


    <script>
        // Default exercises structure
        const defaultExercises = {
          Chest: ['Dumbbell Bench Press', 'Bench Press'],
          Back: ['Lat Pulldown', 'One Arm Dumbbell Row', 'Seated Cable Row'],
          Legs: ['Squat', 'Leg Extensions', 'Leg Press', 'Leg Curls'],
          Shoulders: ['Overhead Press', 'Lateral Raises', 'Front Raises']
        };

        // Load exercises from localStorage (includes custom exercises)
        function loadExercises() {
          const customExercises = JSON.parse(localStorage.getItem('customExercises')) || {};
          const exercises = { ...defaultExercises };
          
          // Merge custom exercises with default ones
          Object.keys(customExercises).forEach(category => {
            if (exercises[category]) {
              // Add custom exercises to existing category (avoid duplicates)
              customExercises[category].forEach(exercise => {
                if (!exercises[category].includes(exercise)) {
                  exercises[category].push(exercise);
                }
              });
            } else {
              // New category
              exercises[category] = customExercises[category];
            }
          });
          
          return exercises;
        }

        // Dynamic exercises object that updates with custom exercises
        let exercises = loadExercises();

        // Save custom exercises to localStorage
        function saveCustomExercises() {
          const customExercises = {};
          
          Object.keys(exercises).forEach(category => {
            const defaultExs = defaultExercises[category] || [];
            const customExs = exercises[category].filter(ex => !defaultExs.includes(ex));
            
            if (customExs.length > 0) {
              customExercises[category] = customExs;
            }
          });
          
          localStorage.setItem('customExercises', JSON.stringify(customExercises));
        }

        // Function to add new exercise
        function saveNewExercise() {
          const exerciseName = document.getElementById('exercise-name-input').value.trim();
          const category = document.getElementById('exercise-category-select').value;
          
          if (!exerciseName) {
            showToast('Please enter an exercise name', 'error');
            return;
          }
          
          // Check if exercise already exists in any category
          let exerciseExists = false;
          Object.keys(exercises).forEach(cat => {
            if (exercises[cat].some(ex => ex.toLowerCase() === exerciseName.toLowerCase())) {
              exerciseExists = true;
            }
          });
          
          if (exerciseExists) {
            showToast('This exercise already exists!', 'error');
            return;
          }
          
          // Add exercise to the selected category
          if (!exercises[category]) {
            exercises[category] = [];
          }
          
          exercises[category].push(exerciseName);
          
          // Save to localStorage
          saveCustomExercises();
          
          // Update the day select dropdown if new category was created
          updateDaySelectOptions();
          
          // Close modal and clear form
          document.getElementById('add-exercise-modal').classList.add('hidden');
          clearExerciseForm();
          
          // Refresh exercises if current day matches the category
          const currentDay = document.getElementById('day-select').value;
          if (currentDay === category) {
            renderExercises();
          }
          
          showToast(`✅ "${exerciseName}" added to ${category} successfully!`, 'success', 4000);
        }

        function clearExerciseForm() {
          document.getElementById('exercise-name-input').value = '';
          document.getElementById('exercise-category-select').value = 'Chest';
        }

        function updateDaySelectOptions() {
          const daySelect = document.getElementById('day-select');
          const currentValue = daySelect.value;
          
          // Clear existing options
          daySelect.innerHTML = '';
          
          // Add all available categories
          Object.keys(exercises).sort().forEach(category => {
            const option = document.createElement('option');
            option.value = category;
            option.textContent = category;
            daySelect.appendChild(option);
          });
          
          // Restore previous selection if still available
          if (exercises[currentValue]) {
            daySelect.value = currentValue;
          }
        }

        const quotePool = [
          "Push yourself, because no one else is going to do it for you.",
          "It’s going to be a journey. It’s not a sprint to get in shape.",
          "No pain, no gain!",
          "You don’t have to be extreme, just consistent.",
          "Strong body, strong mind!"
        ];

        document.getElementById('day-select').addEventListener('change', renderExercises);
        document.getElementById('save-btn').addEventListener('click', saveWorkout);
        document.getElementById('load-last-btn').addEventListener('click', () => {
          const btn = document.getElementById('load-last-btn');
          const btnText = btn.querySelector('.btn-text');
          const btnLoading = btn.querySelector('.btn-loading');
          
          // Show loading state
          btnText.style.display = 'none';
          btnLoading.style.display = 'inline';
          btn.disabled = true;
          btn.style.opacity = '0.7';
          
          // Load session with delay to show loading state
          setTimeout(() => {
            loadLastSession();
            
            // Reset button state
            setTimeout(() => {
              btnText.style.display = 'inline';
              btnLoading.style.display = 'none';
              btn.disabled = false;
              btn.style.opacity = '1';
            }, 200);
          }, 300);
        });
        document.getElementById('auto-fill-btn').addEventListener('click', autoFillSuggested);
        document.getElementById('history-btn').addEventListener('click', showProgress);
        document.getElementById('close-modal').addEventListener('click', () => {
          document.getElementById('progress-modal').classList.add('hidden');
        });

        document.getElementById('close-sessions-modal').addEventListener('click', () => {
          document.getElementById('sessions-modal').classList.add('hidden');
        });

        // Add Exercise Modal Event Listeners
        document.getElementById('add-exercise-btn').addEventListener('click', () => {
          document.getElementById('add-exercise-modal').classList.remove('hidden');
          document.getElementById('exercise-name-input').focus();
        });

        document.getElementById('close-add-exercise-modal').addEventListener('click', () => {
          document.getElementById('add-exercise-modal').classList.add('hidden');
          clearExerciseForm();
        });

        document.getElementById('cancel-exercise-btn').addEventListener('click', () => {
          document.getElementById('add-exercise-modal').classList.add('hidden');
          clearExerciseForm();
        });

        document.getElementById('save-exercise-btn').addEventListener('click', saveNewExercise);

        // Close add exercise modal when clicking outside
        document.getElementById('add-exercise-modal').addEventListener('click', (e) => {
          if (e.target.id === 'add-exercise-modal') {
            document.getElementById('add-exercise-modal').classList.add('hidden');
            clearExerciseForm();
          }
        });

        // Enter key to save exercise
        document.getElementById('exercise-name-input').addEventListener('keydown', (e) => {
          if (e.key === 'Enter') {
            saveNewExercise();
          }
        });

        // Close modals when clicking outside of them
        document.getElementById('progress-modal').addEventListener('click', (e) => {
          if (e.target.id === 'progress-modal') {
            document.getElementById('progress-modal').classList.add('hidden');
          }
        });

        document.getElementById('sessions-modal').addEventListener('click', (e) => {
          if (e.target.id === 'sessions-modal') {
            document.getElementById('sessions-modal').classList.add('hidden');
          }
        });

        // Context menu for load button
        document.getElementById('load-last-btn').addEventListener('contextmenu', (e) => {
          e.preventDefault();
          const contextMenu = document.getElementById('load-context-menu');
          contextMenu.style.left = e.pageX + 'px';
          contextMenu.style.top = e.pageY + 'px';
          contextMenu.classList.remove('hidden');
        });

        // Hide context menu when clicking elsewhere
        document.addEventListener('click', (e) => {
          const contextMenu = document.getElementById('load-context-menu');
          if (!contextMenu.contains(e.target) && e.target.id !== 'load-last-btn') {
            contextMenu.classList.add('hidden');
          }
        });

        // Context menu item handlers
        document.querySelectorAll('.context-item').forEach(item => {
          item.addEventListener('click', (e) => {
            const action = e.target.dataset.action;
            document.getElementById('load-context-menu').classList.add('hidden');
            
            switch(action) {
              case 'load-last':
                loadLastSession();
                break;
              case 'load-complete':
                loadLastCompleteWorkout();
                break;
              case 'load-best':
                loadBestPerformance();
                break;
              case 'browse-sessions':
                browseSessions();
                break;
            }
          });
        });

        // Hover effects for context menu
        document.querySelectorAll('.context-item').forEach(item => {
          item.addEventListener('mouseenter', () => {
            item.style.background = '#f8f9fa';
          });
          item.addEventListener('mouseleave', () => {
            item.style.background = '';
          });
        });
        document.getElementById('python-analytics-btn').addEventListener('click', openPythonAnalytics);
        
        // Mobile-specific enhancements
        function initializeMobileFeatures() {
          // Add touch feedback for mobile devices
          if ('ontouchstart' in window) {
            // Add touch class to body for CSS targeting
            document.body.classList.add('touch-device');
            
            // Improve button touch feedback
            document.querySelectorAll('button').forEach(btn => {
              btn.addEventListener('touchstart', function() {
                this.style.transform = 'scale(0.98)';
              });
              
              btn.addEventListener('touchend', function() {
                setTimeout(() => {
                  this.style.transform = '';
                }, 100);
              });
            });
            
            // Add swipe gesture for modal closing
            let startY = 0;
            document.querySelectorAll('.modal').forEach(modal => {
              modal.addEventListener('touchstart', function(e) {
                startY = e.touches[0].clientY;
              });
              
              modal.addEventListener('touchmove', function(e) {
                const currentY = e.touches[0].clientY;
                const diffY = currentY - startY;
                
                // If swiping down significantly, close modal
                if (diffY > 100 && e.target === this) {
                  this.classList.add('hidden');
                }
              });
            });
            
            // Prevent zoom on double tap for inputs
            document.querySelectorAll('input, button, select').forEach(element => {
              element.addEventListener('touchend', function(e) {
                e.preventDefault();
                this.click();
              });
            });
          }
          
          // Responsive font size adjustment
          function adjustFontSizes() {
            const width = window.innerWidth;
            if (width < 400) {
              document.documentElement.style.fontSize = '14px';
            } else if (width < 768) {
              document.documentElement.style.fontSize = '15px';
            } else {
              document.documentElement.style.fontSize = '16px';
            }
          }
          
          adjustFontSizes();
          window.addEventListener('resize', adjustFontSizes);
          
          // Better mobile keyboard handling
          let viewport = document.querySelector("meta[name=viewport]");
          let isKeyboardOpen = false;
          
          window.addEventListener('resize', function() {
            const heightDifference = window.screen.height - window.innerHeight;
            
            if (heightDifference > 150) { // Keyboard likely open
              if (!isKeyboardOpen) {
                isKeyboardOpen = true;
                document.body.classList.add('keyboard-open');
                // Scroll to focused input
                setTimeout(() => {
                  const focused = document.activeElement;
                  if (focused && focused.tagName === 'INPUT') {
                    focused.scrollIntoView({ behavior: 'smooth', block: 'center' });
                  }
                }, 300);
              }
            } else {
              if (isKeyboardOpen) {
                isKeyboardOpen = false;
                document.body.classList.remove('keyboard-open');
              }
            }
          });
        }
        
        // Initialize mobile features when DOM is ready
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', initializeMobileFeatures);
        } else {
          initializeMobileFeatures();
        }
        
        // Workout timer event listeners
        document.getElementById('start-rest-btn').addEventListener('click', startRestTimer);
        document.getElementById('stop-rest-btn').addEventListener('click', stopRestTimer);

        // Function to toggle exercise visibility
        function toggleExercise(exerciseId) {
          const exercise = document.getElementById(exerciseId);
          const content = exercise.querySelector('.exercise-content');
          const icon = exercise.querySelector('.collapse-icon');
          const header = exercise.querySelector('.exercise-header');
          
          const isCollapsed = content.style.maxHeight === '0px' || content.style.maxHeight === '';
          
          if (isCollapsed) {
            // Expand
            content.style.maxHeight = content.scrollHeight + 'px';
            content.style.opacity = '1';
            content.style.marginTop = '10px';
            icon.textContent = '−';
            icon.style.transform = 'rotate(0deg)';
            header.style.backgroundColor = '#f8f9fa';
          } else {
            // Collapse
            content.style.maxHeight = '0px';
            content.style.opacity = '0';
            content.style.marginTop = '0px';
            icon.textContent = '+';
            icon.style.transform = 'rotate(90deg)';
            header.style.backgroundColor = '#e9ecef';
          }
        }

        // Function to collapse all exercises
        function collapseAllExercises() {
          document.querySelectorAll('.exercise').forEach(exercise => {
            const exerciseId = exercise.id;
            const content = exercise.querySelector('.exercise-content');
            const icon = exercise.querySelector('.collapse-icon');
            const header = exercise.querySelector('.exercise-header');
            
            if (content.style.maxHeight !== '0px') {
              content.style.maxHeight = '0px';
              content.style.opacity = '0';
              content.style.marginTop = '0px';
              icon.textContent = '+';
              icon.style.transform = 'rotate(90deg)';
              header.style.backgroundColor = '#e9ecef';
            }
          });
        }

        // Function to expand all exercises
        function expandAllExercises() {
          document.querySelectorAll('.exercise').forEach(exercise => {
            const exerciseId = exercise.id;
            const content = exercise.querySelector('.exercise-content');
            const icon = exercise.querySelector('.collapse-icon');
            const header = exercise.querySelector('.exercise-header');
            
            if (content.style.maxHeight === '0px' || content.style.maxHeight === '') {
              content.style.maxHeight = content.scrollHeight + 'px';
              content.style.opacity = '1';
              content.style.marginTop = '10px';
              icon.textContent = '−';
              icon.style.transform = 'rotate(0deg)';
              header.style.backgroundColor = '#f8f9fa';
            }
          });
        }

        function renderExercises() {
          const selectedDay = document.getElementById('day-select').value;
          const container = document.getElementById('exercise-container');
          
          // Get last session data for comparison
          const lastSessionData = getLastSessionData(selectedDay);
          
          container.innerHTML = exercises[selectedDay].map((exercise, index) => {
            const lastWeights = lastSessionData[exercise] || {};
            const suggestion = generateProgressSuggestion(exercise, lastWeights);
            const exerciseId = `exercise-${selectedDay}-${index}`;
            
            const sets = Array.from({ length: 3 }, (_, i) => {
              const setNum = i + 1;
              const lastWeight = lastWeights[`Set ${setNum}`] || '';
              const suggestedWeight = lastWeight ? parseFloat(lastWeight) + 2.5 : '';
              
              return `<div class="set-container">
                <label>Set ${setNum}:</label>
                <div class="weight-controls">
                  <button type="button" class="weight-btn" onclick="adjustWeight(this, -2.5)" tabindex="-1">-2.5</button>
                  <input type="number" min="0" step="0.5" data-ex="${exercise}" data-set="${setNum}" placeholder="${suggestedWeight ? suggestedWeight + 'kg' : 'kg'}" title="Last: ${lastWeight || 'N/A'}" />
                  <button type="button" class="weight-btn" onclick="adjustWeight(this, 2.5)" tabindex="-1">+2.5</button>
                </div>
                ${lastWeight ? `<span style="font-size: 0.85em; color: #666; margin-top: 4px; display: block; text-align: center;">Last: ${lastWeight}kg</span>` : ''}
              </div>`;
            }).join('');
            
            return `<div class="exercise" id="${exerciseId}">
              <div class="exercise-header" onclick="toggleExercise('${exerciseId}')" style="display: flex; align-items: center; justify-content: space-between; cursor: pointer; padding: 10px; background: #f8f9fa; border-radius: 8px; margin-bottom: 10px; transition: all 0.3s ease;">
                <h3 style="margin: 0; color: #495057;">${exercise}</h3>
                <span class="collapse-icon" style="font-size: 1.2rem; color: #667eea; transition: transform 0.3s ease;">−</span>
              </div>
              <div class="exercise-content" style="transition: all 0.3s ease; overflow: hidden;">
                ${suggestion}
                ${sets}
                <button class="save-exercise-btn" data-exercise="${exercise}" style="margin-top: 15px; background: #28a745; width: 100%;">💾 Save ${exercise}</button>
              </div>
            </div>`;
          }).join('');

          // Add event listeners to individual save buttons
          document.querySelectorAll('.save-exercise-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
              const exerciseName = e.target.dataset.exercise;
              saveIndividualExercise(exerciseName);
            });
          });

          document.getElementById('motivational-quote').textContent =
            quotePool[Math.floor(Math.random() * quotePool.length)];

          // Auto-focus first input for better keyboard navigation
          setTimeout(() => {
            const firstInput = document.querySelector('input[data-ex]');
            if (firstInput) {
              firstInput.focus();
              firstInput.select();
            }
          }, 100);
        }



        function showProgress() {
          const selectedDay = document.getElementById('day-select').value;
          
          // Initialize tabs
          initializeProgressTabs();
          
          // Load overview data
          loadOverviewTab(selectedDay);
          
          // Show modal
          document.getElementById('progress-modal').classList.remove('hidden');
          
          // Add shine effect to button
          const historyBtn = document.getElementById('history-btn');
          const shineEffect = historyBtn.querySelector('.shine-effect');
          if (shineEffect) {
            shineEffect.style.left = '100%';
            setTimeout(() => {
              shineEffect.style.left = '-100%';
            }, 500);
          }
        }

        function initializeProgressTabs() {
          const tabButtons = document.querySelectorAll('.tab-btn');
          const tabContents = document.querySelectorAll('.tab-content');
          
          tabButtons.forEach(btn => {
            btn.addEventListener('click', () => {
              const tabName = btn.dataset.tab;
              
              // Update button styles
              tabButtons.forEach(b => {
                b.style.background = '#f8f9fa';
                b.style.color = '#666';
                b.classList.remove('active');
              });
              btn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
              btn.style.color = 'white';
              btn.classList.add('active');
              
              // Show/hide content
              tabContents.forEach(content => content.classList.add('hidden'));
              document.getElementById(`tab-${tabName}`).classList.remove('hidden');
              
              // Load tab-specific content
              const selectedDay = document.getElementById('day-select').value;
              switch(tabName) {
                case 'overview':
                  loadOverviewTab(selectedDay);
                  break;
                case 'trends':
                  loadTrendsTab(selectedDay);
                  break;
                case 'records':
                  loadRecordsTab(selectedDay);
                  break;
                case 'insights':
                  loadInsightsTab(selectedDay);
                  break;
              }
            });
          });
        }

        function loadOverviewTab(selectedDay) {
          const sessions = getAllSessions(selectedDay);
          const statsCards = document.getElementById('stats-cards');
          const recentSessions = document.getElementById('recent-sessions');
          
          // Generate stats cards
          const stats = calculateStats(sessions, selectedDay);
          statsCards.innerHTML = `
            <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 12px; text-align: center;">
              <h3 style="margin: 0 0 10px 0; font-size: 2.5rem;">${stats.totalSessions}</h3>
              <p style="margin: 0; opacity: 0.9;">Total Sessions</p>
            </div>
            <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 20px; border-radius: 12px; text-align: center;">
              <h3 style="margin: 0 0 10px 0; font-size: 2.5rem;">${stats.avgWeight}kg</h3>
              <p style="margin: 0; opacity: 0.9;">Average Weight</p>
            </div>
            <div class="stat-card" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); color: #333; padding: 20px; border-radius: 12px; text-align: center;">
              <h3 style="margin: 0 0 10px 0; font-size: 2.5rem;">${stats.totalVolume}kg</h3>
              <p style="margin: 0; opacity: 0.8;">Total Volume</p>
            </div>
            <div class="stat-card" style="background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); color: #333; padding: 20px; border-radius: 12px; text-align: center;">
              <h3 style="margin: 0 0 10px 0; font-size: 2.5rem;">${stats.improvement}%</h3>
              <p style="margin: 0; opacity: 0.8;">Improvement</p>
            </div>
          `;
          
          // Generate recent sessions with collapsible cards
          recentSessions.innerHTML = `
            <h3 style="margin-bottom: 15px; color: #667eea;">📅 Recent Sessions</h3>
            ${sessions.slice(0, 10).map((session, index) => `
              <div class="session-card" onclick="toggleSessionCard(this)">
                <div class="session-header">
                  <div>
                    <strong style="color: #667eea;">${new Date(session.timestamp).toLocaleDateString()}</strong>
                    <span style="margin-left: 10px; color: #666; font-size: 0.9em;">
                      ${Object.keys(session.data).filter(k => k !== 'timestamp').length} exercises
                    </span>
                  </div>
                  <span class="expand-icon" style="font-size: 1.2rem; color: #667eea;">▼</span>
                </div>
                <div class="session-details">
                  <div style="padding: 15px 0;">
                    ${Object.entries(session.data).filter(([k]) => k !== 'timestamp').map(([exercise, sets]) => `
                      <div class="exercise-item">
                        <strong style="color: #495057;">${exercise}:</strong>
                        <span style="margin-left: 10px; color: #667eea;">
                          ${Object.values(sets).map(w => w + 'kg').join(' • ')}
                        </span>
                      </div>
                    `).join('')}
                  </div>
                </div>
              </div>
            `).join('')}
          `;
        }

        function toggleSessionCard(card) {
          const details = card.querySelector('.session-details');
          const icon = card.querySelector('.expand-icon');
          const isExpanded = details.style.maxHeight !== '0px' && details.style.maxHeight !== '';
          
          if (isExpanded) {
            details.style.maxHeight = '0px';
            details.style.padding = '0 20px';
            icon.textContent = '▼';
            card.style.borderColor = '#eee';
          } else {
            details.style.maxHeight = details.scrollHeight + 'px';
            details.style.padding = '0 20px';
            icon.textContent = '▲';
            card.style.borderColor = '#667eea';
          }
        }

        function loadTrendsTab(selectedDay) {
          const sessions = getAllSessions(selectedDay);
          populateExerciseFilter(selectedDay);
          drawProgressChart(sessions, selectedDay);
        }

        function loadRecordsTab(selectedDay) {
          const sessions = getAllSessions(selectedDay);
          const records = calculatePersonalRecords(sessions, selectedDay);
          const personalRecords = document.getElementById('personal-records');
          
          personalRecords.innerHTML = Object.entries(records).map(([exercise, record]) => `
            <div style="
              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
              color: white; 
              padding: 20px; 
              border-radius: 12px; 
              text-align: center;
              position: relative;
              overflow: hidden;
            ">
              <div style="position: absolute; top: -50%; right: -50%; width: 100%; height: 100%; background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%); pointer-events: none;"></div>
              <h3 style="margin: 0 0 10px 0; position: relative; z-index: 2;">🏆 ${exercise}</h3>
              <div style="font-size: 2rem; font-weight: bold; margin: 10px 0; position: relative; z-index: 2;">${record.weight}kg</div>
              <p style="margin: 0; opacity: 0.9; font-size: 0.9em; position: relative; z-index: 2;">
                ${new Date(record.date).toLocaleDateString()}
              </p>
              <div style="margin-top: 10px; padding: 8px; background: rgba(255,255,255,0.2); border-radius: 6px; position: relative; z-index: 2;">
                <small>Set: ${record.set} • Session: ${record.sessionType}</small>
              </div>
            </div>
          `).join('');
        }

        function loadInsightsTab(selectedDay) {
          const sessions = getAllSessions(selectedDay);
          const insights = generateAIInsights(sessions, selectedDay);
          const insightsContent = document.getElementById('insights-content');
          const workoutPatterns = document.getElementById('workout-patterns');
          
          insightsContent.innerHTML = insights.map(insight => `
            <div style="margin-bottom: 15px; padding: 15px; background: rgba(255,255,255,0.2); border-radius: 8px;">
              <div style="display: flex; align-items: center; margin-bottom: 8px;">
                <span style="font-size: 1.5rem; margin-right: 10px;">${insight.icon}</span>
                <strong>${insight.title}</strong>
              </div>
              <p style="margin: 0; opacity: 0.9;">${insight.message}</p>
            </div>
          `).join('');
          
          // Workout patterns
          const patterns = analyzeWorkoutPatterns(sessions);
          workoutPatterns.innerHTML = `
            <h3 style="color: #667eea; margin-bottom: 15px;">📊 Workout Patterns</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
              ${Object.entries(patterns).map(([pattern, data]) => `
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #667eea;">
                  <strong style="color: #495057;">${pattern}</strong>
                  <p style="margin: 5px 0 0 0; color: #666;">${data}</p>
                </div>
              `).join('')}
            </div>
          `;
        }

        function getAllSessions(selectedDay) {
          const sessions = [];
          Object.keys(localStorage).forEach(key => {
            if (key.startsWith(selectedDay + '_') && !key.includes('darkMode') && !key.includes('pomodoroState')) {
              const log = JSON.parse(localStorage.getItem(key));
              sessions.push({
                key,
                timestamp: log.timestamp,
                data: log
              });
            }
          });
          return sessions.sort((a, b) => b.timestamp - a.timestamp);
        }

        function calculateStats(sessions, selectedDay) {
          if (sessions.length === 0) {
            return { totalSessions: 0, avgWeight: 0, totalVolume: 0, improvement: 0 };
          }
          
          let totalWeight = 0;
          let totalSets = 0;
          let totalVolume = 0;
          
          sessions.forEach(session => {
            Object.entries(session.data).forEach(([exercise, sets]) => {
              if (exercise !== 'timestamp') {
                Object.values(sets).forEach(weight => {
                  const w = parseFloat(weight) || 0;
                  totalWeight += w;
                  totalVolume += w * 3; // Assuming 3 reps per set
                  totalSets++;
                });
              }
            });
          });
          
          const avgWeight = totalSets > 0 ? (totalWeight / totalSets).toFixed(1) : 0;
          
          // Calculate improvement (compare first vs last session)
          let improvement = 0;
          if (sessions.length >= 2) {
            const firstSession = sessions[sessions.length - 1];
            const lastSession = sessions[0];
            
            let firstAvg = 0, lastAvg = 0, commonExercises = 0;
            
            Object.keys(firstSession.data).forEach(exercise => {
              if (exercise !== 'timestamp' && lastSession.data[exercise]) {
                const firstWeights = Object.values(firstSession.data[exercise]).map(w => parseFloat(w) || 0);
                const lastWeights = Object.values(lastSession.data[exercise]).map(w => parseFloat(w) || 0);
                
                firstAvg += firstWeights.reduce((a, b) => a + b, 0) / firstWeights.length;
                lastAvg += lastWeights.reduce((a, b) => a + b, 0) / lastWeights.length;
                commonExercises++;
              }
            });
            
            if (commonExercises > 0) {
              improvement = (((lastAvg / commonExercises) - (firstAvg / commonExercises)) / (firstAvg / commonExercises) * 100).toFixed(1);
            }
          }
          
          return {
            totalSessions: sessions.length,
            avgWeight: avgWeight,
            totalVolume: totalVolume.toFixed(0),
            improvement: improvement
          };
        }

        function calculatePersonalRecords(sessions, selectedDay) {
          const records = {};
          
          sessions.forEach(session => {
            Object.entries(session.data).forEach(([exercise, sets]) => {
              if (exercise !== 'timestamp') {
                Object.entries(sets).forEach(([setName, weight]) => {
                  const w = parseFloat(weight) || 0;
                  if (!records[exercise] || w > records[exercise].weight) {
                    records[exercise] = {
                      weight: w,
                      date: session.timestamp,
                      set: setName,
                      sessionType: session.key.includes('_') ? 'Individual' : 'Full Workout'
                    };
                  }
                });
              }
            });
          });
          
          return records;
        }

        function generateAIInsights(sessions, selectedDay) {
          const insights = [];
          
          if (sessions.length === 0) {
            return [{ icon: '🤖', title: 'Getting Started', message: 'Start tracking your workouts to get personalized insights!' }];
          }
          
          // Consistency insight
          const daysBetween = sessions.length > 1 ? 
            Math.round((sessions[0].timestamp - sessions[sessions.length - 1].timestamp) / (1000 * 60 * 60 * 24)) / (sessions.length - 1) : 0;
          
          if (daysBetween <= 2) {
            insights.push({ icon: '🔥', title: 'Consistency Champion', message: `Amazing! You're training every ${daysBetween.toFixed(1)} days on average. Keep this momentum!` });
          } else if (daysBetween <= 7) {
            insights.push({ icon: '💪', title: 'Steady Progress', message: `Good consistency with ${daysBetween.toFixed(1)} days between sessions. Consider increasing frequency for faster gains.` });
          }
          
          // Volume insight
          const stats = calculateStats(sessions, selectedDay);
          if (stats.totalVolume > 10000) {
            insights.push({ icon: '🏋️', title: 'Volume Beast', message: `Impressive ${stats.totalVolume}kg total volume! You're building serious strength.` });
          }
          
          // Improvement insight
          if (stats.improvement > 0) {
            insights.push({ icon: '📈', title: 'Progressive Overload', message: `${stats.improvement}% improvement since you started! Your progressive overload is working perfectly.` });
          } else if (stats.improvement < -5) {
            insights.push({ icon: '⚠️', title: 'Recovery Check', message: 'Recent performance dip detected. Consider checking your sleep, nutrition, or reducing training intensity.' });
          }
          
          return insights;
        }

        function analyzeWorkoutPatterns(sessions) {
          const patterns = {};
          
          // Most active day pattern
          const dayFrequency = {};
          sessions.forEach(session => {
            const day = new Date(session.timestamp).toLocaleDateString('en-US', { weekday: 'long' });
            dayFrequency[day] = (dayFrequency[day] || 0) + 1;
          });
          
          const mostActiveDay = Object.entries(dayFrequency).reduce((a, b) => dayFrequency[a[0]] > dayFrequency[b[0]] ? a : b, ['Monday', 0]);
          patterns['Most Active Day'] = `${mostActiveDay[0]} (${mostActiveDay[1]} sessions)`;
          
          // Average session duration (estimated)
          patterns['Estimated Session Duration'] = '45-60 minutes (based on exercise count)';
          
          // Favorite exercise
          const exerciseFrequency = {};
          sessions.forEach(session => {
            Object.keys(session.data).forEach(exercise => {
              if (exercise !== 'timestamp') {
                exerciseFrequency[exercise] = (exerciseFrequency[exercise] || 0) + 1;
              }
            });
          });
          
          if (Object.keys(exerciseFrequency).length > 0) {
            const favExercise = Object.entries(exerciseFrequency).reduce((a, b) => exerciseFrequency[a[0]] > exerciseFrequency[b[0]] ? a : b);
            patterns['Most Trained Exercise'] = `${favExercise[0]} (${favExercise[1]} times)`;
          }
          
          return patterns;
        }

        function populateExerciseFilter(selectedDay) {
          const exerciseFilter = document.getElementById('exercise-filter');
          const allExercises = new Set();
          
          Object.keys(localStorage).forEach(key => {
            if (key.startsWith(selectedDay + '_') && !key.includes('darkMode') && !key.includes('pomodoroState')) {
              const session = JSON.parse(localStorage.getItem(key));
              Object.keys(session).forEach(exercise => {
                if (exercise !== 'timestamp') {
                  allExercises.add(exercise);
                }
              });
            }
          });
          
          exerciseFilter.innerHTML = '<option value="all">All Exercises</option>' +
            Array.from(allExercises).map(exercise => `<option value="${exercise}">${exercise}</option>`).join('');
        }

        function drawProgressChart(sessions, selectedDay) {
          // This is a placeholder for a more advanced charting library
          // For now, we'll create a simple text-based representation
          const canvas = document.getElementById('progress-chart');
          const ctx = canvas.getContext('2d');
          
          // Clear canvas
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          
          // Draw placeholder chart
          ctx.fillStyle = '#667eea';
          ctx.font = '20px Arial';
          ctx.textAlign = 'center';
          ctx.fillText('📈 Progress Chart Coming Soon!', canvas.width / 2, canvas.height / 2 - 20);
          ctx.font = '14px Arial';
          ctx.fillStyle = '#666';
          ctx.fillText('Chart visualization will be added with Chart.js library', canvas.width / 2, canvas.height / 2 + 20);
        }

        function downloadExcel() {
          try {
            console.log('Starting Excel download...');
            
            // Check if XLSX is loaded
            if (typeof XLSX === 'undefined') {
              showToast('Excel library not loaded. Please refresh the page.', 'error');
              return;
            }
            
            const wb = XLSX.utils.book_new();
            const wsData = [["Day", "Date & Time", "Exercise", "Set 1", "Set 2", "Set 3"]];
            let rowCount = 1;

            Object.keys(localStorage).forEach(key => {
              // Skip non-workout data
              if (key.includes('darkMode') || key.includes('pomodoroState') || key.includes('sidebar')) {
                return;
              }
              
              // Handle both old format (Day_timestamp) and new format (Day_timestamp_ExerciseName)
              const parts = key.split('_');
              if (parts.length < 2) return;

              try {
                const day = parts[0];
                const data = JSON.parse(localStorage.getItem(key));
                
                if (!data || !data.timestamp) return;
                
                const dateTime = new Date(data.timestamp).toLocaleString();

                Object.entries(data).forEach(([exercise, sets]) => {
                  if (exercise !== 'timestamp' && sets && typeof sets === 'object') {
                    wsData.push([
                      day,
                      dateTime,
                      exercise,
                      sets["Set 1"] || "",
                      sets["Set 2"] || "",
                      sets["Set 3"] || ""
                    ]);
                    rowCount++;
                  }
                });
              } catch (e) {
                console.log('Error parsing data for key:', key, e);
              }
            });

            console.log(`Processed ${rowCount} rows of data`);
            
            if (rowCount <= 1) {
              showToast('No workout data found to export!', 'error');
              return;
            }

            const ws = XLSX.utils.aoa_to_sheet(wsData);
            XLSX.utils.book_append_sheet(wb, ws, "Gym Progress");
            
            // Generate filename with date
            const now = new Date();
            const filename = `Gym_Progress_${now.getFullYear()}-${(now.getMonth()+1).toString().padStart(2,'0')}-${now.getDate().toString().padStart(2,'0')}.xlsx`;
            
            XLSX.writeFile(wb, filename);
            
            showToast(`✅ Excel file "${filename}" downloaded successfully! ${rowCount-1} records exported 🐍`, "success", 5000);
            console.log('Excel download completed successfully');
            
          } catch (error) {
            console.error('Excel download error:', error);
            showToast(`❌ Excel download failed: ${error.message}`, "error", 5000);
          }
        }

        function openPythonAnalytics() {
          console.log('Python Analytics button clicked!');
          
          // Analyze current data for preview (no auto-download)
          const allSessions = [];
          Object.keys(localStorage).forEach(key => {
            if (!key.includes('darkMode') && !key.includes('pomodoroState')) {
              const parts = key.split('_');
              if (parts.length >= 2) {
                try {
                  const data = JSON.parse(localStorage.getItem(key));
                  const day = parts[0];
                  const timestamp = parseInt(parts[1]);
                  allSessions.push({ key, day, timestamp, data });
                } catch (e) {
                  // Skip invalid data
                }
              }
            }
          });
          
          console.log(`Found ${allSessions.length} sessions for analysis`);
          
          if (allSessions.length === 0) {
            showToast('No workout data found! Add some workouts first.', 'error');
            return;
          }
          
          // Calculate preview statistics
          const stats = {
            totalSessions: allSessions.length,
            muscleGroups: {},
            exerciseCount: {},
            dateRange: null,
            topExercises: {},
            progressExamples: []
          };
          
          allSessions.forEach(session => {
            stats.muscleGroups[session.day] = (stats.muscleGroups[session.day] || 0) + 1;
            
            Object.keys(session.data).forEach(exercise => {
              if (exercise !== 'timestamp') {
                stats.exerciseCount[exercise] = (stats.exerciseCount[exercise] || 0) + 1;
                
                const sets = session.data[exercise];
                if (sets) {
                  const weights = Object.values(sets).map(w => parseFloat(w) || 0);
                  const maxWeight = Math.max(...weights);
                  
                  if (!stats.topExercises[exercise] || maxWeight > stats.topExercises[exercise]) {
                    stats.topExercises[exercise] = maxWeight;
                  }
                }
              }
            });
          });
          
          // Find date range
          if (allSessions.length > 0) {
            const dates = allSessions.map(s => s.timestamp).sort();
            const startDate = new Date(dates[0]).toLocaleDateString();
            const endDate = new Date(dates[dates.length - 1]).toLocaleDateString();
            stats.dateRange = startDate === endDate ? startDate : `${startDate} - ${endDate}`;
          }
          
          // Get top exercises
          const topExercisesList = Object.entries(stats.exerciseCount)
            .sort((a, b) => b[1] - a[1])
            .slice(0, 5)
            .map(([ex, count]) => `${ex} (${count}x)`);
          
          // Get muscle group distribution
          const muscleDistribution = Object.entries(stats.muscleGroups)
            .sort((a, b) => b[1] - a[1])
            .map(([muscle, count]) => `${muscle}: ${count} sessions`);
          
          // Show enhanced modal with data preview
          setTimeout(() => {
            const modal = document.createElement('div');
            modal.style.cssText = `
              position: fixed;
              top: 0;
              left: 0;
              width: 100%;
              height: 100%;
              background: rgba(0,0,0,0.9);
              z-index: 10000;
              display: flex;
              justify-content: center;
              align-items: center;
              overflow-y: auto;
            `;
            
            modal.innerHTML = `
              <div style="
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 40px;
                border-radius: 20px;
                max-width: 800px;
                width: 90%;
                max-height: 90vh;
                overflow-y: auto;
                text-align: center;
                box-shadow: 0 20px 60px rgba(0,0,0,0.5);
                position: relative;
              ">
                <button onclick="this.parentElement.parentElement.remove()" style="
                  position: absolute;
                  top: 15px;
                  right: 20px;
                  background: rgba(255,255,255,0.2);
                  color: white;
                  border: none;
                  font-size: 24px;
                  cursor: pointer;
                  width: 40px;
                  height: 40px;
                  border-radius: 50%;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                ">&times;</button>
                
                <h2 style="margin: 0 0 30px 0; font-size: 2.5rem;">🐍 Python Analytics Preview</h2>
                
                <div style="background: rgba(255,255,255,0.15); padding: 25px; border-radius: 15px; margin: 25px 0; text-align: left;">
                  <h3 style="margin: 0 0 20px 0; text-align: center; color: #FFE066;">📊 Your Data Summary</h3>
                  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 20px;">
                    <div style="text-align: center; background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px;">
                      <div style="font-size: 2rem; font-weight: bold;">${stats.totalSessions}</div>
                      <div style="opacity: 0.9;">Total Sessions</div>
                    </div>
                    <div style="text-align: center; background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px;">
                      <div style="font-size: 2rem; font-weight: bold;">${Object.keys(stats.exerciseCount).length}</div>
                      <div style="opacity: 0.9;">Unique Exercises</div>
                    </div>
                    <div style="text-align: center; background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px;">
                      <div style="font-size: 2rem; font-weight: bold;">${Object.keys(stats.muscleGroups).length}</div>
                      <div style="opacity: 0.9;">Muscle Groups</div>
                    </div>
                  </div>
                  
                  ${stats.dateRange ? `<p><strong>📅 Date Range:</strong> ${stats.dateRange}</p>` : ''}
                  
                  ${muscleDistribution.length > 0 ? `
                    <div style="margin: 20px 0;">
                      <strong>💪 Muscle Group Focus:</strong><br>
                      ${muscleDistribution.join('<br>')}
                    </div>
                  ` : ''}
                  
                  ${topExercisesList.length > 0 ? `
                    <div style="margin: 20px 0;">
                      <strong>🏆 Top Exercises:</strong><br>
                      ${topExercisesList.join('<br>')}
                    </div>
                  ` : ''}
                  
                  ${Object.keys(stats.topExercises).length > 0 ? `
                    <div style="margin: 20px 0;">
                      <strong>🎯 Personal Records:</strong><br>
                      ${Object.entries(stats.topExercises).slice(0, 5).map(([ex, weight]) => `${ex}: ${weight}kg`).join('<br>')}
                    </div>
                  ` : ''}
                </div>
                
                <div style="background: rgba(255,255,255,0.1); padding: 25px; border-radius: 15px; margin: 25px 0; text-align: left;">
                  <h3 style="margin: 0 0 15px 0; text-align: center; color: #FFE066;">🚀 Advanced Python Analytics Features</h3>
                  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px;">
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px;">
                      <div style="font-size: 1.5rem; margin-bottom: 10px;">📈</div>
                      <strong>Progressive Overload Analysis</strong><br>
                      <small style="opacity: 0.8;">Track strength gains and plateaus with detailed weight progression charts</small>
                    </div>
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px;">
                      <div style="font-size: 1.5rem; margin-bottom: 10px;">🎯</div>
                      <strong>Volume & Intensity Metrics</strong><br>
                      <small style="opacity: 0.8;">Calculate total volume, training load, and intensity zones for each muscle group</small>
                    </div>
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px;">
                      <div style="font-size: 1.5rem; margin-bottom: 10px;">🧠</div>
                      <strong>ML Trend Analysis & Predictions</strong><br>
                      <small style="opacity: 0.8;">Machine learning predictions for future performance and strength goals</small>
                    </div>
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px;">
                      <div style="font-size: 1.5rem; margin-bottom: 10px;">⚖️</div>
                      <strong>Balance & Symmetry Check</strong><br>
                      <small style="opacity: 0.8;">Identify muscle imbalances and get recommendations for balanced training</small>
                    </div>
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px;">
                      <div style="font-size: 1.5rem; margin-bottom: 10px;">�</div>
                      <strong>Recovery & Frequency Analysis</strong><br>
                      <small style="opacity: 0.8;">Optimize rest periods and training frequency based on your performance data</small>
                    </div>
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px;">
                      <div style="font-size: 1.5rem; margin-bottom: 10px;">🏆</div>
                      <strong>Personal Records Tracking</strong><br>
                      <small style="opacity: 0.8;">Detailed PR tracking with achievement timelines and statistical analysis</small>
                    </div>
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px;">
                      <div style="font-size: 1.5rem; margin-bottom: 10px;">📊</div>
                      <strong>Interactive Visualizations</strong><br>
                      <small style="opacity: 0.8;">Beautiful charts and graphs with Matplotlib, Seaborn, and Plotly</small>
                    </div>
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px;">
                      <div style="font-size: 1.5rem; margin-bottom: 10px;">🎯</div>
                      <strong>Consistency & Pattern Analysis</strong><br>
                      <small style="opacity: 0.8;">Workout frequency patterns with personalized recommendations</small>
                    </div>
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px;">
                      <div style="font-size: 1.5rem; margin-bottom: 10px;">🔍</div>
                      <strong>Statistical Insights</strong><br>
                      <small style="opacity: 0.8;">Advanced statistical analysis including correlation and regression analysis</small>
                    </div>
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px;">
                      <div style="font-size: 1.5rem; margin-bottom: 10px;">📝</div>
                      <strong>Automated Reports</strong><br>
                      <small style="opacity: 0.8;">Generate comprehensive PDF reports with insights and recommendations</small>
                    </div>
                  </div>
                </div>
                
                <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 12px; margin: 25px 0; font-family: 'Courier New', monospace;">
                  <h4 style="margin: 0 0 15px 0; color: #FFE066;">💻 Run the Analysis:</h4>
                  <div style="background: rgba(0,0,0,0.5); padding: 15px; border-radius: 8px; font-size: 1.2rem; color: #4ECDC4;">
                    python analyze_gym_progress.py
                  </div>
                  <p style="margin: 15px 0 0 0; font-size: 0.9rem; opacity: 0.8;">
                    First download the Excel file, then select it when prompted by the Python script
                  </p>
                  <button onclick="downloadExcel(); showToast('📥 Excel downloaded! Now run: python analyze_gym_progress.py 🐍', 'success', 4000);" style="
                    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
                    color: white;
                    border: none;
                    padding: 12px 25px;
                    border-radius: 8px;
                    font-weight: bold;
                    cursor: pointer;
                    margin-top: 15px;
                    font-size: 1rem;
                    transition: all 0.3s ease;
                    box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
                  " onmouseover="this.style.background='linear-gradient(135deg, #218838 0%, #1e7e34 100%)'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(40, 167, 69, 0.4)'" onmouseout="this.style.background='linear-gradient(135deg, #28a745 0%, #20c997 100%)'; this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(40, 167, 69, 0.3)'">
                    📥 Download Excel Data for Python Analysis
                  </button>
                </div>
                
                <div style="margin: 25px 0; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 12px;">
                  <h4 style="margin: 0 0 15px 0; color: #FFE066;">📋 Required Python Libraries:</h4>
                  <div style="font-family: 'Courier New', monospace; font-size: 0.9rem; opacity: 0.9; background: rgba(0,0,0,0.3); padding: 12px; border-radius: 6px; margin-bottom: 10px;">
                    pip install pandas matplotlib seaborn openpyxl scikit-learn numpy plotly
                  </div>
                  <small style="opacity: 0.8;">These libraries enable advanced statistical analysis, machine learning predictions, and beautiful visualizations</small>
                </div>
                
                <button onclick="this.parentElement.parentElement.remove()" style="
                  background: linear-gradient(135deg, #FF6B6B 0%, #4ECDC4 100%);
                  color: white;
                  border: none;
                  padding: 15px 35px;
                  border-radius: 30px;
                  font-weight: bold;
                  cursor: pointer;
                  font-size: 1.2rem;
                  margin-top: 20px;
                  box-shadow: 0 5px 15px rgba(0,0,0,0.3);
                  transition: transform 0.2s;
                " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                  🚀 Ready to Analyze!
                </button>
              </div>
            `;
            
            document.body.appendChild(modal);
            
            // Add shine effect
            const pythonBtn = document.getElementById('python-analytics-btn');
            const pythonShine = pythonBtn.querySelector('.python-shine-effect');
            if (pythonShine) {
              pythonShine.style.left = '100%';
              setTimeout(() => {
                pythonShine.style.left = '-100%';
              }, 500);
            }
          }, 1000);
        }
        document.getElementById('reset-btn').addEventListener('click', () => {
          if (confirm('Are you sure you want to delete all saved workouts?')) {
            localStorage.clear();
            showToast('All workout data has been cleared!');
            document.getElementById('history-logs').innerHTML = '';
          }
        });

        document.addEventListener('keydown', function(e) {
          const inputs = Array.from(document.querySelectorAll('input[data-ex]'));
          const saveButtons = Array.from(document.querySelectorAll('.save-exercise-btn'));
          const weightButtons = Array.from(document.querySelectorAll('.weight-btn'));
          const mainButtons = Array.from(document.querySelectorAll('#save-btn, #load-last-btn, #history-btn, #python-analytics-btn, #reset-btn'));
          
          const active = document.activeElement;
          const currentIndex = inputs.indexOf(active);
          const saveButtonIndex = saveButtons.indexOf(active);
          const weightButtonIndex = weightButtons.indexOf(active);
          const mainButtonIndex = mainButtons.indexOf(active);

          // Handle navigation from weight input fields
          if (currentIndex !== -1) {
            switch (e.key) {
              case 'ArrowRight':
              case 'Tab': {
                if (!e.shiftKey) {
                  const next = inputs[currentIndex + 1];
                  if (next) {
                    next.focus();
                    next.select();
                    e.preventDefault();
                  } else {
                    // Jump to first save button if at last input
                    if (saveButtons.length > 0) {
                      saveButtons[0].focus();
                      e.preventDefault();
                    }
                  }
                }
                break;
              }

              case 'ArrowLeft': {
                const prev = inputs[currentIndex - 1];
                if (prev) {
                  prev.focus();
                  prev.select();
                  e.preventDefault();
                }
                break;
              }

              case 'ArrowDown': {
                const currentSet = active.dataset.set;
                const currentExercise = active.dataset.ex;

                for (let i = currentIndex + 1; i < inputs.length; i++) {
                  if (
                    inputs[i].dataset.set === currentSet &&
                    inputs[i].dataset.ex !== currentExercise
                  ) {
                    inputs[i].focus();
                    inputs[i].select();
                    e.preventDefault();
                    return;
                  }
                }
                
                // If no next exercise in same set, go to save button for this exercise
                const exerciseSection = active.closest('.exercise');
                const exerciseSaveBtn = exerciseSection.querySelector('.save-exercise-btn');
                if (exerciseSaveBtn) {
                  exerciseSaveBtn.focus();
                  e.preventDefault();
                }
                break;
              }

              case 'ArrowUp': {
                const currentSet = active.dataset.set;
                const currentExercise = active.dataset.ex;

                for (let i = currentIndex - 1; i >= 0; i--) {
                  if (
                    inputs[i].dataset.set === currentSet &&
                    inputs[i].dataset.ex !== currentExercise
                  ) {
                    inputs[i].focus();
                    inputs[i].select();
                    e.preventDefault();
                    return;
                  }
                }
                break;
              }

              case 'Enter': {
                // Save the current exercise when pressing Enter
                const exerciseSection = active.closest('.exercise');
                const exerciseName = exerciseSection.querySelector('h3').textContent.trim();
                saveIndividualExercise(exerciseName);
                e.preventDefault();
                break;
              }

              case 'Home':
                inputs[0].focus();
                inputs[0].select();
                e.preventDefault();
                break;

              case 'End':
                inputs[inputs.length - 1].focus();
                inputs[inputs.length - 1].select();
                e.preventDefault();
                break;

              // Quick shortcuts for weight adjustment
              case '+':
              case '=':
                if (e.ctrlKey) {
                  const plusBtn = active.parentNode.querySelector('.weight-btn[onclick*="+2.5"]');
                  if (plusBtn) plusBtn.click();
                  e.preventDefault();
                }
                break;
                
              case '-':
                if (e.ctrlKey) {
                  const minusBtn = active.parentNode.querySelector('.weight-btn[onclick*="-2.5"]');
                  if (minusBtn) minusBtn.click();
                  e.preventDefault();
                }
                break;

              default:
                break;
            }
          }

          // Handle navigation from save buttons
          else if (saveButtonIndex !== -1) {
            switch (e.key) {
              case 'ArrowDown':
              case 'Tab': {
                if (!e.shiftKey) {
                  const nextSaveBtn = saveButtons[saveButtonIndex + 1];
                  if (nextSaveBtn) {
                    nextSaveBtn.focus();
                    e.preventDefault();
                  } else {
                    // Jump to main buttons
                    if (mainButtons.length > 0) {
                      mainButtons[0].focus();
                      e.preventDefault();
                    }
                  }
                }
                break;
              }

              case 'ArrowUp': {
                const prevSaveBtn = saveButtons[saveButtonIndex - 1];
                if (prevSaveBtn) {
                  prevSaveBtn.focus();
                  e.preventDefault();
                } else {
                  // Jump to last input
                  if (inputs.length > 0) {
                    inputs[inputs.length - 1].focus();
                    inputs[inputs.length - 1].select();
                    e.preventDefault();
                  }
                }
                break;
              }

              case 'ArrowLeft':
              case 'ArrowRight': {
                // Navigate to inputs within the same exercise
                const exerciseSection = active.closest('.exercise');
                const exerciseInputs = Array.from(exerciseSection.querySelectorAll('input[data-ex]'));
                if (exerciseInputs.length > 0) {
                  exerciseInputs[e.key === 'ArrowLeft' ? exerciseInputs.length - 1 : 0].focus();
                  exerciseInputs[e.key === 'ArrowLeft' ? exerciseInputs.length - 1 : 0].select();
                  e.preventDefault();
                }
                break;
              }

              case 'Enter':
              case ' ': {
                active.click();
                e.preventDefault();
                break;
              }
            }
          }

          // Handle navigation from main buttons
          else if (mainButtonIndex !== -1) {
            switch (e.key) {
              case 'ArrowLeft':
              case 'ArrowUp': {
                const prevBtn = mainButtons[mainButtonIndex - 1];
                if (prevBtn) {
                  prevBtn.focus();
                  e.preventDefault();
                } else {
                  // Jump to last save button
                  if (saveButtons.length > 0) {
                    saveButtons[saveButtons.length - 1].focus();
                    e.preventDefault();
                  }
                }
                break;
              }

              case 'ArrowRight':
              case 'ArrowDown':
              case 'Tab': {
                if (!e.shiftKey) {
                  const nextBtn = mainButtons[mainButtonIndex + 1];
                  if (nextBtn) {
                    nextBtn.focus();
                    e.preventDefault();
                  }
                }
                break;
              }

              case 'Enter':
              case ' ': {
                active.click();
                e.preventDefault();
                break;
              }
            }
          }

          // Global shortcuts
          switch (e.key) {
            case 'Escape': {
              // Close modal if open
              const progressModal = document.getElementById('progress-modal');
              const sessionsModal = document.getElementById('sessions-modal');
              const contextMenu = document.getElementById('load-context-menu');
              
              if (!progressModal.classList.contains('hidden')) {
                progressModal.classList.add('hidden');
                e.preventDefault();
              } else if (!sessionsModal.classList.contains('hidden')) {
                sessionsModal.classList.add('hidden');
                e.preventDefault();
              } else if (!contextMenu.classList.contains('hidden')) {
                contextMenu.classList.add('hidden');
                e.preventDefault();
              }
              break;
            }

            case 'F1': {
              // Focus first input
              if (inputs.length > 0) {
                inputs[0].focus();
                inputs[0].select();
                e.preventDefault();
              }
              break;
            }

            case 'F2': {
              // Load last session
              loadLastSession();
              e.preventDefault();
              break;
            }

            case 'F3': {
              // Show progress
              showProgress();
              e.preventDefault();
              break;
            }

            case 'F4': {
              // Start rest timer
              startRestTimer();
              e.preventDefault();
              break;
            }

            case 'F5': {
              // Stop rest timer
              stopRestTimer();
              e.preventDefault();
              break;
            }
          }

          // Handle Shift+Tab for reverse navigation
          if (e.key === 'Tab' && e.shiftKey) {
            if (currentIndex !== -1) {
              const prev = inputs[currentIndex - 1];
              if (prev) {
                prev.focus();
                prev.select();
                e.preventDefault();
              }
            } else if (saveButtonIndex !== -1) {
              const prevSaveBtn = saveButtons[saveButtonIndex - 1];
              if (prevSaveBtn) {
                prevSaveBtn.focus();
                e.preventDefault();
              } else {
                // Jump to last input
                if (inputs.length > 0) {
                  inputs[inputs.length - 1].focus();
                  inputs[inputs.length - 1].select();
                  e.preventDefault();
                }
              }
            } else if (mainButtonIndex !== -1) {
              const prevBtn = mainButtons[mainButtonIndex - 1];
              if (prevBtn) {
                prevBtn.focus();
                e.preventDefault();
              } else {
                // Jump to last save button
                if (saveButtons.length > 0) {
                  saveButtons[saveButtons.length - 1].focus();
                  e.preventDefault();
                }
              }
            }
          }
        });
        function showToast(message, type = "success", duration = 3000) {
          const toast = document.getElementById("toast");
          toast.textContent = message;
          toast.className = "toast show"; // reset classes
          if (type === "error") {
            toast.classList.add("error");
          }

          setTimeout(() => {
            toast.className = "toast hidden";
          }, duration);
        }

        function saveWorkout() {
          const selectedDay = document.getElementById('day-select').value;
          const exerciseSections = document.querySelectorAll(".exercise");
          let workoutData = { timestamp: Date.now() };
          let isValid = true;

          exerciseSections.forEach((section) => {
            const exerciseName = section.querySelector("h3").textContent.trim();
            const sets = section.querySelectorAll("input");
            let values = Array.from(sets).map(input => input.value.trim());

            const allEmpty = values.every(val => val === "");
            if (!allEmpty) {
              const anyEmpty = values.some(val => val === "");
              if (anyEmpty) {
                showToast(`Please fill all 3 sets for exercise: ${exerciseName}`, "error");
                isValid = false;
                return;
              }

              // Convert to numbers, no negatives
              const weights = values.map(val => {
                const num = parseFloat(val);
                return isNaN(num) ? 0 : Math.max(0, num);
              });

              workoutData[exerciseName] = {
                "Set 1": weights[0],
                "Set 2": weights[1],
                "Set 3": weights[2]
              };
            }
          });

          if (!isValid) return;

          // Save with key like "Chest_1690771800000"
          const storageKey = `${selectedDay}_${workoutData.timestamp}`;
          localStorage.setItem(storageKey, JSON.stringify(workoutData));
          showToast("Workout saved successfully!", "success");
        }

        function saveIndividualExercise(exerciseName) {
          // Start workout timer on first save
          startWorkoutTimer();
          
          const selectedDay = document.getElementById('day-select').value;
          const exerciseSection = document.querySelector(`[data-exercise="${exerciseName}"]`).closest('.exercise');
          const sets = exerciseSection.querySelectorAll("input");
          let values = Array.from(sets).map(input => input.value.trim());

          const allEmpty = values.every(val => val === "");
          if (allEmpty) {
            showToast(`Please enter weights for ${exerciseName}`, "error");
            return;
          }

          const anyEmpty = values.some(val => val === "");
          if (anyEmpty) {
            showToast(`Please fill all 3 sets for ${exerciseName}`, "error");
            return;
          }

          // Convert to numbers, no negatives
          const weights = values.map(val => {
            const num = parseFloat(val);
            return isNaN(num) ? 0 : Math.max(0, num);
          });

          const workoutData = {
            timestamp: Date.now(),
            [exerciseName]: {
              "Set 1": weights[0],
              "Set 2": weights[1],
              "Set 3": weights[2]
            }
          };

          // Save with key like "Chest_1690771800000_LatPulldown"
          const storageKey = `${selectedDay}_${workoutData.timestamp}_${exerciseName.replace(/\s+/g, '')}`;
          localStorage.setItem(storageKey, JSON.stringify(workoutData));
          
          // Check for progress vs last session
          const lastData = getLastSessionData(selectedDay);
          const progressInfo = calculateProgress(exerciseName, weights, lastData[exerciseName]);
          
          showToast(`${exerciseName} saved successfully! ${progressInfo}`, "success");
          
          // Visual feedback - mark exercise as saved
          exerciseSection.classList.add('saved');
          const saveBtn = exerciseSection.querySelector('.save-exercise-btn');
          saveBtn.textContent = `✅ ${exerciseName} Saved`;
          saveBtn.style.background = '#28a745';
          
          // Clear the inputs after saving
          sets.forEach(input => input.value = '');
          
          // Auto-start rest timer
          startRestTimer();
          
          // Reset button after 2 seconds
          setTimeout(() => {
            exerciseSection.classList.remove('saved');
            saveBtn.textContent = `💾 Save ${exerciseName}`;
            saveBtn.style.background = '#28a745';
          }, 2000);
        }

        function calculateProgress(exerciseName, currentWeights, lastWeights) {
          if (!lastWeights) return '🆕 First time!';
          
          const currentAvg = currentWeights.reduce((a, b) => a + b, 0) / 3;
          const lastAvg = Object.values(lastWeights).reduce((sum, weight) => sum + parseFloat(weight || 0), 0) / 3;
          
          const diff = currentAvg - lastAvg;
          
          if (diff > 0) return `📈 +${diff.toFixed(1)}kg improvement!`;
          if (diff < 0) return `📉 ${diff.toFixed(1)}kg from last time`;
          return `🔄 Same as last time`;
        }

        function loadLastSession() {
          const selectedDay = document.getElementById('day-select').value;
          const relevantKeys = Object.keys(localStorage)
            .filter(key => key.startsWith(selectedDay + '_') && !key.includes('darkMode') && !key.includes('pomodoroState'))
            .sort()
            .reverse(); // Get most recent first

          if (relevantKeys.length === 0) {
            showToast(`No previous sessions found for ${selectedDay}`, "error");
            return;
          }

          // Find the most recent complete session (prefer full workout over individual exercises)
          let lastSessionKey = null;
          let lastSessionData = null;
          
          // First, try to find a complete workout session
          for (const key of relevantKeys) {
            const sessionData = JSON.parse(localStorage.getItem(key));
            const exerciseCount = Object.keys(sessionData).filter(k => k !== 'timestamp').length;
            
            // If this session has multiple exercises, prioritize it
            if (exerciseCount > 1) {
              lastSessionKey = key;
              lastSessionData = sessionData;
              break;
            }
          }
          
          // If no complete session found, use the most recent individual save
          if (!lastSessionKey) {
            lastSessionKey = relevantKeys[0];
            lastSessionData = JSON.parse(localStorage.getItem(lastSessionKey));
          }

          // Combine data from multiple recent sessions if needed
          const combinedData = {};
          const currentExercises = exercises[selectedDay];
          
          // Look through recent sessions to find data for all current exercises
          for (const exercise of currentExercises) {
            let found = false;
            for (const key of relevantKeys.slice(0, 10)) { // Check last 10 sessions
              const sessionData = JSON.parse(localStorage.getItem(key));
              if (sessionData[exercise] && !found) {
                combinedData[exercise] = sessionData[exercise];
                found = true;
              }
            }
          }
          
          let loadedCount = 0;
          let totalInputs = 0;
          
          // Load the data into inputs with visual feedback
          Object.entries(combinedData).forEach(([exerciseName, sets]) => {
            const exerciseSection = Array.from(document.querySelectorAll('.exercise')).find(section => 
              section.querySelector('h3').textContent.trim() === exerciseName
            );
            
            if (exerciseSection) {
              const inputs = exerciseSection.querySelectorAll('input');
              totalInputs += inputs.length;
              
              // Add loading animation
              exerciseSection.style.transition = 'all 0.3s ease';
              exerciseSection.style.background = '#e8f5e8';
              
              // Load values with delay for visual effect
              setTimeout(() => {
                inputs[0].value = sets["Set 1"] || '';
                setTimeout(() => {
                  inputs[1].value = sets["Set 2"] || '';
                  setTimeout(() => {
                    inputs[2].value = sets["Set 3"] || '';
                    loadedCount += 3;
                    
                    // Flash green to show data loaded
                    inputs.forEach(input => {
                      if (input.value) {
                        input.style.background = '#d4edda';
                        input.style.borderColor = '#28a745';
                        setTimeout(() => {
                          input.style.background = '';
                          input.style.borderColor = '';
                        }, 1000);
                      }
                    });
                  }, 100);
                }, 100);
              }, 100);
              
              // Reset exercise background
              setTimeout(() => {
                exerciseSection.style.background = '';
              }, 800);
            }
          });

          // Enhanced success message
          const sessionDate = new Date(lastSessionData.timestamp).toLocaleString();
          const sessionsUsed = Object.keys(combinedData).length;
          
          setTimeout(() => {
            if (loadedCount > 0) {
              showToast(
                `✅ Loaded ${loadedCount} weights from ${sessionsUsed} exercise(s) | Last session: ${sessionDate}`, 
                "success", 
                4000
              );
              
              // Auto-focus first loaded input
              const firstLoadedInput = document.querySelector('input[value]:not([value=""])');
              if (firstLoadedInput) {
                setTimeout(() => {
                  firstLoadedInput.focus();
                  firstLoadedInput.select();
                }, 500);
              }
            } else {
              showToast('No weights found to load from previous sessions', 'error');
            }
          }, 500);

          // Add session info to UI temporarily
          const infoDiv = document.createElement('div');
          infoDiv.style.cssText = `
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(40, 167, 69, 0.95);
            color: white;
            padding: 20px;
            border-radius: 10px;
            z-index: 10000;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
          `;
          infoDiv.innerHTML = `
            <h3 style="margin: 0 0 10px 0;">📋 Session Loaded</h3>
            <p style="margin: 5px 0;">Date: ${sessionDate}</p>
            <p style="margin: 5px 0;">Exercises: ${Object.keys(combinedData).join(', ')}</p>
            <p style="margin: 5px 0; font-size: 0.9em; opacity: 0.9;">
              💡 Tip: Press F1 to focus first input or Tab to navigate
            </p>
          `;
          
          document.body.appendChild(infoDiv);
          
          // Remove info div after 3 seconds
          setTimeout(() => {
            infoDiv.style.opacity = '0';
            infoDiv.style.transform = 'translate(-50%, -50%) scale(0.8)';
            setTimeout(() => {
              document.body.removeChild(infoDiv);
            }, 300);
          }, 3000);
        }

        function loadLastCompleteWorkout() {
          const selectedDay = document.getElementById('day-select').value;
          const relevantKeys = Object.keys(localStorage)
            .filter(key => key.startsWith(selectedDay + '_') && !key.includes('darkMode') && !key.includes('pomodoroState'))
            .sort()
            .reverse();

          if (relevantKeys.length === 0) {
            showToast(`No previous sessions found for ${selectedDay}`, "error");
            return;
          }

          // Find the most recent session with multiple exercises (complete workout)
          let completeSession = null;
          for (const key of relevantKeys) {
            const sessionData = JSON.parse(localStorage.getItem(key));
            const exerciseCount = Object.keys(sessionData).filter(k => k !== 'timestamp').length;
            
            if (exerciseCount >= 2) { // At least 2 exercises = complete workout
              completeSession = { key, data: sessionData };
              break;
            }
          }

          if (!completeSession) {
            showToast('No complete workout sessions found. Loading most recent instead.', 'error');
            loadLastSession();
            return;
          }

          loadSessionData(completeSession.data, 'last complete workout');
        }

        function loadBestPerformance() {
          const selectedDay = document.getElementById('day-select').value;
          const relevantKeys = Object.keys(localStorage)
            .filter(key => key.startsWith(selectedDay + '_') && !key.includes('darkMode') && !key.includes('pomodoroState'));

          if (relevantKeys.length === 0) {
            showToast(`No previous sessions found for ${selectedDay}`, "error");
            return;
          }

          // Find best performance for each exercise
          const bestPerformances = {};
          const currentExercises = exercises[selectedDay];

          currentExercises.forEach(exercise => {
            let bestSession = null;
            let bestAverage = 0;

            relevantKeys.forEach(key => {
              const sessionData = JSON.parse(localStorage.getItem(key));
              if (sessionData[exercise]) {
                const weights = Object.values(sessionData[exercise]).map(w => parseFloat(w) || 0);
                const average = weights.reduce((a, b) => a + b, 0) / weights.length;
                
                if (average > bestAverage) {
                  bestAverage = average;
                  bestSession = sessionData[exercise];
                }
              }
            });

            if (bestSession) {
              bestPerformances[exercise] = bestSession;
            }
          });

          if (Object.keys(bestPerformances).length === 0) {
            showToast('No performance data found', 'error');
            return;
          }

          // Create a synthetic session with best performances
          const bestSession = {
            timestamp: Date.now(),
            ...bestPerformances
          };

          loadSessionData(bestSession, 'best performance data');
        }

        function browseSessions() {
          const selectedDay = document.getElementById('day-select').value;
          const relevantKeys = Object.keys(localStorage)
            .filter(key => key.startsWith(selectedDay + '_') && !key.includes('darkMode') && !key.includes('pomodoroState'))
            .sort()
            .reverse();

          if (relevantKeys.length === 0) {
            showToast(`No previous sessions found for ${selectedDay}`, "error");
            return;
          }

          const sessionsList = document.getElementById('sessions-list');
          sessionsList.innerHTML = '';

          relevantKeys.forEach((key, index) => {
            const sessionData = JSON.parse(localStorage.getItem(key));
            const date = new Date(sessionData.timestamp).toLocaleString();
            const exerciseCount = Object.keys(sessionData).filter(k => k !== 'timestamp').length;
            const exerciseNames = Object.keys(sessionData).filter(k => k !== 'timestamp').join(', ');

            const sessionDiv = document.createElement('div');
            sessionDiv.style.cssText = `
              padding: 15px;
              margin: 10px 0;
              background: #f8f9fa;
              border-radius: 8px;
              border: 1px solid #dee2e6;
              cursor: pointer;
              transition: all 0.2s ease;
            `;

            sessionDiv.innerHTML = `
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                  <strong>${date}</strong>
                  <br>
                  <small style="color: #666;">${exerciseCount} exercise(s): ${exerciseNames}</small>
                </div>
                <button onclick="loadSpecificSession('${key}')" style="
                  background: #007bff; 
                  color: white; 
                  border: none; 
                  padding: 5px 10px; 
                  border-radius: 4px;
                  cursor: pointer;
                ">Load</button>
              </div>
            `;

            sessionDiv.addEventListener('mouseenter', () => {
              sessionDiv.style.background = '#e9ecef';
              sessionDiv.style.transform = 'translateY(-2px)';
            });

            sessionDiv.addEventListener('mouseleave', () => {
              sessionDiv.style.background = '#f8f9fa';
              sessionDiv.style.transform = 'translateY(0)';
            });

            sessionsList.appendChild(sessionDiv);
          });

          document.getElementById('sessions-modal').classList.remove('hidden');
        }

        function loadSpecificSession(sessionKey) {
          const sessionData = JSON.parse(localStorage.getItem(sessionKey));
          loadSessionData(sessionData, 'selected session');
          document.getElementById('sessions-modal').classList.add('hidden');
        }

        function loadSessionData(sessionData, sourceDescription) {
          let loadedCount = 0;
          
          Object.entries(sessionData).forEach(([exerciseName, sets]) => {
            if (exerciseName !== 'timestamp') {
              const exerciseSection = Array.from(document.querySelectorAll('.exercise')).find(section => 
                section.querySelector('h3').textContent.trim() === exerciseName
              );
              
              if (exerciseSection) {
                const inputs = exerciseSection.querySelectorAll('input');
                
                // Add loading animation
                exerciseSection.style.transition = 'all 0.3s ease';
                exerciseSection.style.background = '#e8f5e8';
                
                // Load values
                inputs[0].value = sets["Set 1"] || '';
                inputs[1].value = sets["Set 2"] || '';
                inputs[2].value = sets["Set 3"] || '';
                loadedCount += 3;
                
                // Visual feedback
                inputs.forEach(input => {
                  if (input.value) {
                    input.style.background = '#d4edda';
                    input.style.borderColor = '#28a745';
                    setTimeout(() => {
                      input.style.background = '';
                      input.style.borderColor = '';
                    }, 1000);
                  }
                });
                
                // Reset exercise background
                setTimeout(() => {
                  exerciseSection.style.background = '';
                }, 800);
              }
            }
          });

          const sessionDate = new Date(sessionData.timestamp).toLocaleString();
          showToast(`✅ Loaded ${loadedCount} weights from ${sourceDescription} | ${sessionDate}`, "success", 4000);
        }

        function autoFillSuggested() {
          const selectedDay = document.getElementById('day-select').value;
          const lastSessionData = getLastSessionData(selectedDay);
          
          if (Object.keys(lastSessionData).length === 0) {
            showToast('No previous session found to base suggestions on', 'error');
            return;
          }

          let fillCount = 0;
          
          exercises[selectedDay].forEach(exercise => {
            const lastWeights = lastSessionData[exercise];
            if (lastWeights) {
              const exerciseSection = Array.from(document.querySelectorAll('.exercise')).find(section => 
                section.querySelector('h3').textContent.trim() === exercise
              );
              
              if (exerciseSection) {
                const inputs = exerciseSection.querySelectorAll('input');
                // Fill with +2.5kg from last session
                Object.values(lastWeights).forEach((weight, index) => {
                  if (inputs[index] && weight) {
                    const suggested = parseFloat(weight) + 2.5;
                    inputs[index].value = suggested;
                    fillCount++;
                  }
                });
              }
            }
          });

          if (fillCount > 0) {
            showToast(`Auto-filled ${fillCount} suggested weights (+2.5kg from last session) 🎯`, 'success');
          } else {
            showToast('No weights could be auto-filled', 'error');
          }
        }

        function adjustWeight(button, amount) {
          const input = button.parentNode.querySelector('input');
          const currentValue = parseFloat(input.value) || 0;
          const newValue = Math.max(0, currentValue + amount);
          input.value = newValue === 0 ? '' : newValue;
        }

        function getLastSessionData(selectedDay) {
          const relevantKeys = Object.keys(localStorage)
            .filter(key => key.startsWith(selectedDay + '_') && !key.includes('darkMode') && !key.includes('pomodoroState'))
            .sort()
            .reverse();

          if (relevantKeys.length === 0) return {};

          const lastSession = JSON.parse(localStorage.getItem(relevantKeys[0]));
          const result = {};
          
          Object.entries(lastSession).forEach(([exercise, sets]) => {
            if (exercise !== 'timestamp') {
              result[exercise] = sets;
            }
          });
          
          return result;
        }

        function generateProgressSuggestion(exercise, lastWeights) {
          if (!lastWeights || Object.keys(lastWeights).length === 0) {
            return '<div class="exercise-suggestion">💡 First time doing this exercise? Start with a comfortable weight!</div>';
          }

          const avgLastWeight = Object.values(lastWeights).reduce((sum, weight) => sum + parseFloat(weight || 0), 0) / 3;
          const suggested = avgLastWeight + 2.5;
          
          return `<div class="exercise-suggestion">
            🎯 Progressive Overload: Try ${suggested}kg (+2.5kg from last session average: ${avgLastWeight.toFixed(1)}kg)
          </div>`;
        }

        // Workout Timer Functions
        let workoutStartTime = null;
        let totalWorkoutInterval = null;
        let restStartTime = null;
        let restInterval = null;
        const defaultRestTime = 90; // 90 seconds

        function startWorkoutTimer() {
          if (!workoutStartTime) {
            workoutStartTime = Date.now();
            totalWorkoutInterval = setInterval(updateTotalTime, 1000);
          }
        }

        function updateTotalTime() {
          if (!workoutStartTime) return;
          const elapsed = Math.floor((Date.now() - workoutStartTime) / 1000);
          const hours = Math.floor(elapsed / 3600);
          const minutes = Math.floor((elapsed % 3600) / 60);
          const seconds = elapsed % 60;
          document.getElementById('total-time').textContent = 
            `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function startRestTimer() {
          if (restInterval) clearInterval(restInterval);
          
          restStartTime = Date.now();
          let remainingTime = defaultRestTime;
          
          const updateRest = () => {
            const elapsed = Math.floor((Date.now() - restStartTime) / 1000);
            remainingTime = Math.max(0, defaultRestTime - elapsed);
            
            const minutes = Math.floor(remainingTime / 60);
            const seconds = remainingTime % 60;
            document.getElementById('rest-time').textContent = 
              `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            if (remainingTime === 0) {
              clearInterval(restInterval);
              showToast('Rest time is up! Time for the next set! 💪', 'success');
              document.getElementById('rest-time').style.color = '#dc3545';
              setTimeout(() => {
                document.getElementById('rest-time').style.color = '';
              }, 3000);
            }
          };
          
          restInterval = setInterval(updateRest, 1000);
          updateRest(); // Update immediately
          showToast('Rest timer started! 😴', 'success');
        }

        function stopRestTimer() {
          if (restInterval) {
            clearInterval(restInterval);
            restInterval = null;
            document.getElementById('rest-time').textContent = '00:00';
            showToast('Rest timer stopped', 'success');
          }
        }

        // Dark mode toggle
        const toggle = document.getElementById('dark-mode-toggle');

        // Load saved preference from localStorage
        if (localStorage.getItem('darkMode') === 'enabled') {
          document.body.classList.add('dark-mode');
          toggle.checked = true;
        }

        toggle.addEventListener('change', () => {
          if (toggle.checked) {
            document.body.classList.add('dark-mode');
            localStorage.setItem('darkMode', 'enabled');
          } else {
            document.body.classList.remove('dark-mode');
            localStorage.setItem('darkMode', 'disabled');
          }
        });
        const gallery = document.querySelector('.quote-gallery');
        const scrollAmount = 315; // scroll by approx one image width + gap (300 + 15)

        let scrollPos = 0;

        function autoScrollGallery() {
          if (!gallery) return;

          // Scroll right by scrollAmount
          scrollPos += scrollAmount;

          // If scroll position exceeds scrollWidth - clientWidth, reset to 0
          if (scrollPos > gallery.scrollWidth - gallery.clientWidth) {
            scrollPos = 0;
          }

          gallery.scrollTo({
            left: scrollPos,
            behavior: 'smooth'
          });
        }
        // Add hover effect for history button
        document.getElementById('history-btn').addEventListener('mouseenter', () => {
          const btn = document.getElementById('history-btn');
          const shineEffect = btn.querySelector('.shine-effect');
          if (shineEffect) {
            shineEffect.style.left = '100%';
            setTimeout(() => {
              shineEffect.style.left = '-100%';
            }, 500);
          }
        });

        // Auto scroll every 6 seconds (6000 ms)
        setInterval(autoScrollGallery, 6000);
        
        // Sidebar functionality
        function initializeSidebar() {
          const sidebar = document.getElementById('sidebar');
          const sidebarToggle = document.getElementById('sidebar-toggle');
          const main = document.querySelector('main');
          
          let sidebarOpen = false;
          
          sidebarToggle.addEventListener('click', () => {
            sidebarOpen = !sidebarOpen;
            
            if (sidebarOpen) {
              sidebar.classList.add('open');
              main.classList.add('sidebar-open');
              sidebarToggle.innerHTML = '✕';
              sidebarToggle.title = 'Close Control Panel';
              sidebarToggle.style.background = 'linear-gradient(135deg, #dc3545 0%, #e83e8c 100%)';
            } else {
              sidebar.classList.remove('open');
              main.classList.remove('sidebar-open');
              sidebarToggle.innerHTML = '⚙️';
              sidebarToggle.title = 'Open Control Panel';
              sidebarToggle.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            }
          });
          
          // Close sidebar when clicking outside on mobile
          document.addEventListener('click', (e) => {
            if (window.innerWidth <= 768 && sidebarOpen && 
                !sidebar.contains(e.target) && 
                !sidebarToggle.contains(e.target)) {
              sidebar.classList.remove('open');
              main.classList.remove('sidebar-open');
              sidebarToggle.innerHTML = '⚙️';
              sidebarToggle.title = 'Open Control Panel';
              sidebarToggle.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
              sidebarOpen = false;
            }
          });
          
          // Update sidebar info when day changes
          function updateSidebarInfo() {
            const selectedDay = document.getElementById('day-select').value;
            const exerciseCount = document.querySelectorAll('.exercise').length;
            
            document.getElementById('current-day-display').textContent = selectedDay;
            document.getElementById('exercises-count-display').textContent = exerciseCount;
          }
          
          // Update sidebar info on day change
          document.getElementById('day-select').addEventListener('change', updateSidebarInfo);
          
          // Initial update
          updateSidebarInfo();
          
          // Update exercise count when exercises are rendered
          const originalRenderExercises = window.renderExercises;
          if (originalRenderExercises) {
            window.renderExercises = function() {
              originalRenderExercises.apply(this, arguments);
              setTimeout(updateSidebarInfo, 100); // Small delay to ensure DOM is updated
            };
          }
        }
        
        // Initialize sidebar when DOM is ready
        document.addEventListener('DOMContentLoaded', initializeSidebar);
        
        // Initial load
        updateDaySelectOptions(); // Initialize dropdown with all categories
        renderExercises();


    </script>
</body>
</html>
